<!DOCTYPE html>
<html><!-- manifest="cache.appcache" 開啟Cache 功能-->
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
        <!--ios-->
        <script type="text/javascript" src="js/ios/cordova-2.5.0.js"></script>
        <script type="text/javascript" src="js/ios/flurryPlugin.js"></script>
        <!--android-->
        <!--
         <script type="text/javascript" src="js/android/cordova-2.4.0.js"></script>
        -->
        <!--jQuery-->
        <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
		<!--json2-->
		<script type="text/javascript" src="js/js.min/json2.min.js"></script>
		<!--Google Map API v3-->
		<!--<script type="text/javascript"	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDE9qxWxKreYH34oRyk2RCtM5-VqrauTPc&sensor=false"></script>-->
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<!--mobiScroll-->
		<script src="js/mobiscroll.core.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/mobiscroll.select.js"></script>
		<link href="css/mobiscroll.custom-2.4.3.min.css" rel="stylesheet" type="text/css"></link>
		<script src="js/mobiscroll.custom.js" type="text/javascript"></script>
		<!--<script src="http://debug.phonegap.com/target/target-script-min.js#blackie1019"></script>-->
		<!--jQuery mobile-->
        <link rel="stylesheet" type="text/css" href="css/jquery.mobile-NSC-1.3.0.css"></link>
        <script type="text/javascript" src="js/jquery.mobile-1.3.0.min.js"></script>
        <!--Plug in-->
        <link rel="stylesheet" type="text/css" href="css/smoke.min.css">
        <!-- <link rel="stylesheet" type="text/css" href="css/smoke.theme.100s.css"> -->
        <script src="js/smoke.js"></script>
		<!--Hyweb CSS-->
		<link rel="stylesheet" type="text/css" href="css/index.css"></link>
		<!-- <link rel="stylesheet" type="text/css" href="css/menu.css"></link> -->
		<!--HYAPP-->
		<!--NSCAPP Javascript-->	
		<script src="js/setting.js"></script>
		<script src="js/loading.js"></script> 
		<script src="js/pnpolygon.js"></script>
		<script src="js/data.js"></script> 
		<script src="js/map.js"></script> 
	</head>
	<body>
		<!--園區簡介-->
		<div class="gridContainer clearfix" data-role="page" id="index">
			<script  type="text/javascript">
			//global variables
			var langType=getAppSetting_Data().language,Park=getIdentifyParkBase().Park,LP_jsonObjectArray=[];
			var park=getIdentifyParkBase().Park,nearAlertSpot=null,Target_Collapsible_Classify1_ID="",map;//地圖模組
			//function
			//更換相關顯示語言
			function loadDisplayLanguage(){
				var title,a_ParkRoute_str,a_LifeService_str,a_VendorInfo_str,a_VisitInfo_str,btn_Back_str,navbar_htmlResult="";
				switch(langType){
					case "ch":
						title="科學園區簡介";
						a_ParkRoute_str="園區路線規劃";
						a_LifeService_str="周邊生活服務";
						a_VendorInfo_str="園區廠商資訊";
						a_VisitInfo_str="如何到園區";
						btn_Back_str="返回";
						$('#index #a_ParkRoute').show();
						break;
					case "eng":
						title="About Science Park";
						a_ParkRoute_str="Get Directions";
						a_LifeService_str="Life in the park";
						a_VendorInfo_str="Companies";
						a_VisitInfo_str="Directions";
						btn_Back_str="Back";
						$('#index #a_ParkRoute').hide();
						break;
				}
				navbar_htmlResult+='<div data-role="navbar"><ul>'+
					(langType=="ch"?'<li class="navli"><a id="a_ParkRoute" rel="external" href="Page_TranspotInfo.html#page_transPlanning">'+a_ParkRoute_str+'</a></li>':"")+
					'<li class="navli"><a id="a_LifeService" rel="external" href="Page_LifeService.html">'+a_LifeService_str+'</a></li>'+
					'<li class="navli"><a id="a_VendorInfo" rel="external" href="Page_VendorInfo.html">'+a_VendorInfo_str+'</a></li>'+
					'</ul></div>';
				$('#index #page_title').text(title);
				$('#index #footer').html(navbar_htmlResult).trigger('create');
				$('#index #footer').find('.ui-btn-inner').css("font-size","1em").css("padding-left","0px").css("padding-right","0px");
				$('#index #footer span').css('display','block');
				$('#VisitInfo_content h1').html(a_VisitInfo_str);
				$('#VisitInfo_content #btnBack').html(btn_Back_str);
				// alert($('#VisitInfo_content #btnBack .ui-btn-text').html());
							//地圖模組
			var map_btnSearch_str,map_btnRoute_str,map_btnClassify1Filter_str,map_btnSetAlert_str,map_btnMAPShow_str,map_btnListShow_str,map_btnRoute_MAPShow_str,map_btnRoute_PathShow_str,map_labRoutePointStart_str,map_labRoutePointEnd_str,map_btnKeyWordSearch_str,map_txtSearchKeyWord_str;
			switch(langType){
				case "ch":
					map_btnSearch_str="搜尋地圖";
					map_btnRoute_str="規劃路徑";
					map_btnClassify1Filter_str="週邊生活服務";
					map_btnSetAlert_str="接近提醒";
					map_btnMAPShow_str="地圖呈現";
					map_btnListShow_str="圖文呈現";
					map_btnRoute_MAPShow_str="地圖導引";
					map_btnRoute_PathShow_str="文字導引";
					map_btnKeyWordSearch_str="查詢";
					map_txtSearchKeyWord_str="地址/地名/廠商名稱";
					map_labRoutePointStart_str="起點";
					map_labRoutePointEnd_str="終點";
					break;
				case "eng":
					map_btnSearch_str="Search Map";
					map_btnRoute_str="Directions";
					map_btnClassify1Filter_str="Nearby";	
					map_btnSetAlert_str="Notification";
					map_btnMAPShow_str="Map View";
					map_btnListShow_str="List View";
					map_btnRoute_MAPShow_str="Map";
					map_btnRoute_PathShow_str="Directions";
					map_btnKeyWordSearch_str="Search";
					map_txtSearchKeyWord_str="Address、Companies";
					map_labRoutePointStart_str="Start";
					map_labRoutePointEnd_str="End";
					break;
			}
			$('#Map_LP #footer').find('#btnSearch').text(map_btnSearch_str);
			$('#Map_LP #footer').find('#btnRoute').text(map_btnRoute_str);
			$('#Map_LP #footer').find('#btnClassify1Filter').text(map_btnClassify1Filter_str);
			$('#Map_LP #footer').find('#btnSetAlert').text(map_btnSetAlert_str);
			$('#Map_LP #footer').find('#btnMAPShow').text(map_btnMAPShow_str);
			$('#Map_LP #footer').find('#btnListShow').text(map_btnListShow_str);
			$('#Map_LP #footer').find('#btnRoute_MAPShow').text(map_btnRoute_MAPShow_str);
			$('#Map_LP #footer').find('#btnRoute_PathShow').text(map_btnRoute_PathShow_str);


			$('#Map_LP #divKeyWordSearch').find("#btnKeyWordSearch").text(map_btnKeyWordSearch_str);
			$('#Map_LP #divKeyWordSearch').find("#txtSearchKeyWord").attr("placeholder",map_txtSearchKeyWord_str);

			$('#Map_LP #divRoutePath').find("#labRoutePointStart").text(map_labRoutePointStart_str);
			$('#Map_LP #divRoutePath').find("#labRoutePointEnd").text(map_labRoutePointEnd_str);
			$('#Map_LP #divRoutePath').find("#txtRoutePointStart").attr("placeholder",map_txtSearchKeyWord_str);
			$('#Map_LP #divRoutePath').find("#txtRoutePointEnd").attr("placeholder",map_txtSearchKeyWord_str);
			$('#Map_LP #divRoutePath').find("#btnDoRoute").text(map_btnRoute_str);
			$('#Map_LP #routeList').find("#divRouteHeader").text(map_btnRoute_str);
			$('#Map_LP #routeList').find("#divDirectionHeader").text(map_btnRoute_str);
			}
			//連到交通資訊
			function goToTranspotInfo(Park,Base,code){
				var PageName="";
				switch(code){
					case "01":
						PageName="index_05";
						break;
					case "02":
						PageName="index_01";
						break;
					case "03":
						PageName="index_02";
						break;
					case "04":
						PageName="index_04";
						break;
					case "05":
						PageName="index_03";
						break;
					case "06":
						PageName="index_09";
						break;
					case "07":
						PageName="index_10";
						break;
					case "08":
						PageName="page_transPlanning";
						break;
				}
				var PageObject={"Park":Park,"Base":Base,"PageName":PageName};
				setTranspotInfoLoadPage(PageObject);
				return true;
			}
			//載入園區個別項目內容頁資訊
			function changeToTrafficContent(Park,Base,code,isFromSelf)
			{	
				 LoadingObject.show();
				 var jsonObjectStr='{"langType":'+langType+',"Park":"'+Park+'"}';
			    $.ajax({
			        url:DataURL_ParkIntro,
			        data:  {"jsonInput":jsonObjectStr},
			        type:"POST",
			        dataType :"json",
			        async:false,
			        success:function(data){ if(data==null){
			                 smoke.alert(ServiceCodeErrorString,{},function(){});
			            }else{
			            	var htmlContent="";
			            	footNavbarsContent="";
			            	for(var i=0;i<data.jsonOutput.Page_ParkIntro_Traffic.length;i++){
								if(data.jsonOutput.Page_ParkIntro_Traffic[i].Base==Base){
						            //options
						            for(var option_index=0;option_index<data.jsonOutput.Page_ParkIntro_Traffic[i].options.length;option_index++){
						           		if(data.jsonOutput.Page_ParkIntro_Traffic[i].options[option_index].code==code){
								            htmlContent+="<div class='title2'>"+data.jsonOutput.Page_ParkIntro_Traffic[i].options[option_index].value+"</div>"+"<div class='springboard'>"+data.jsonOutput.Page_ParkIntro_Traffic[i].options[option_index].HTML+"</div>";
								            for(var navbars_index=0;navbars_index<data.jsonOutput.Page_ParkIntro_Traffic[i].options[option_index].navbars.length;navbars_index++){
								            	footNavbarsContent+='<li class="navli"><a rel="external" href="Page_TranspotInfo.html#loadPage"  onclick="return goToTranspotInfo(&#39;'+data.jsonOutput.Park+'&#39;,&#39;'+data.jsonOutput.Page_ParkIntro_Traffic[i].Base+'&#39;,&#39;'+data.jsonOutput.Page_ParkIntro_Traffic[i].options[option_index].navbars[navbars_index].code+'&#39;);">'+data.jsonOutput.Page_ParkIntro_Traffic[i].options[option_index].navbars[navbars_index].value+'</a></li>';
								            }
								            if(footNavbarsContent!=""){
								            	footNavbarsContent='<div data-role="navbar" id="footNavbars"><ul>'+footNavbarsContent+'</ul></div>';
								            }
								            break;
						           		}
						           	}
						           	break;
					            }
				            }
					        $("#VisitInfo_content").find('#htmlResult').html(htmlContent);
					        if(langType!="eng"){
								$("#VisitInfo_content").find('#footer').html(footNavbarsContent).trigger('create');
								$("#VisitInfo_content").find('#footer').show();
							}else{
								$("#VisitInfo_content").find('#footer').hide();
							}	
							//儲存當下子頁面資料
			 				var BackPageObject={"Park":Park,"Base":Base,"code":code};
							setTranspotInfoBackPage(BackPageObject);
							if(!isFromSelf){
					            $.mobile.changePage('#VisitInfo_content');
					        }
			            }
			        },
			        error: function(data){
			            LoadingObject.hide();
			            smoke.alert(ServiceErrorString,{},function(){});
			        },
			        complete: function() {
			            LoadingObject.hide();
			        }
			    });
			
			}
			//產生如何到園區項目
			function genTrafficHTML(Park,Base,jsonObject,helpTel){
				var result="";
				for(var option_index=0;option_index<jsonObject.options.length;option_index++){
					result+='<input onclick="javascirpt:changeToTrafficContent(&apos;'+Park+'&apos;,&apos;'+Base+'&apos;,&apos;'+jsonObject.options[option_index].code+'&apos;,false);" data-role="none" type="submit" name="button" id="button" data-code="'+jsonObject.options[option_index].code+'" value="'+jsonObject.options[option_index].value+'" class="traffic'+jsonObject.options[option_index].code+'"></input>';	
				}
				result='<div class="aleft2 springboard2">'+result+'</div>'+
						'<div class="helpline">'+helpTel+'</div>';
				return result;
			}

			function genTopList(){
				var menuStringArray=[],htmlResult='';
				switch(langType){
					case "ch":
						menuStringArray.push("園區簡介");
						menuStringArray.push("如何到園區");
						menuStringArray.push("參訪諮詢");
						menuStringArray.push("投資諮詢");
						menuStringArray.push("聯絡資訊");
						menuStringArray.push("文化藝術");
						break;
					case "eng":
						menuStringArray.push("Introduction");
						menuStringArray.push("Directions");
						menuStringArray.push("Visits");
						menuStringArray.push("Investment");
						menuStringArray.push("Contact us");
						menuStringArray.push("Art Infromation");
						break;
				}
				if(menuStringArray.length==6){
					htmlResult+='<ul class="toplist" data-role="none" >'+
						        '<li><a class="sub_link" data-href="subDiv_introInfo">'+menuStringArray[0]+'</a></li>'+
						        '<li><a class="sub_link" data-href="subDiv_traffic">'+menuStringArray[1]+'</a></li>'+
						        '<li><a class="sub_link" data-href="subDiv_visitInfo">'+menuStringArray[2]+'</a></li>'+
						        '<li><a class="sub_link" data-href="subDiv_investmentInfo">'+menuStringArray[3]+'</a></li>'+
						        '<li><a class="sub_link" data-href="subDiv_contactInfo">'+menuStringArray[4]+'</a></li>';
					if(getAppType()=="S"){
		 		        htmlResult+='<li><a class="sub_link" data-href="subDiv_artInfo">'+menuStringArray[5]+'</a></li>';
		 		    }
		 		}
				htmlResult+='</ul>';
				$('#index #sub-menu').html(htmlResult);
			}
			function getAreaIntroData(Park,selectValue,sub){
				 LoadingObject.show();
				 var jsonObjectStr='{"langType":"'+langType+'","Park":"'+Park+'"}';
				 var selectBaseResult="";
			    $.ajax({
			        url:DataURL_ParkIntro,
			        data:  {"jsonInput":jsonObjectStr},
			        type:"POST",
			        dataType :"json",
			        async:false,
			        success:function(data){
			            if(data==null){
			                 smoke.alert(ServiceCodeErrorString,{},function(){});
			            }else{
			            	//園區下拉
			            	for(var i=0;i<data.jsonOutput.Page_ParkIntro_Index.length;i++){
			            		if(sub!="subDiv_introInfo"&&i==0){

			            		}else{
				            		selectBaseResult+='<option value="'+data.jsonOutput.Page_ParkIntro_Index[i].Base+'"';
				            		if(data.jsonOutput.Page_ParkIntro_Index[i].Base=="00"){
				            			selectBaseResult+=' class="isIntroOnly" ';
				            		}
				            		if(data.jsonOutput.Page_ParkIntro_Index[i].Base==selectValue){
				            			selectBaseResult+=' selected ';
				            		}
				            		selectBaseResult+='">'+data.jsonOutput.Page_ParkIntro_Index[i].BaseName+'</option>';
				            	}
			            	}
			            	$("#index #selectBase").html(selectBaseResult).selectmenu().selectmenu('refresh',true);
		            		$("#index #selectBase_temp").html(selectBaseResult);
		            		if(selectValue=="00"){
		            			//index
		            			$("#subDiv_introInfo").html(data.jsonOutput.Page_ParkIntro_Index[0].HTML);
					            //ContactInfo
					            $("#subDiv_contactInfo").html(data.jsonOutput.Page_ParkIntro_ContactInfo[0].HTML);
					            //Traffic
							    $("#subDiv_traffic").html(genTrafficHTML(Park,data.jsonOutput.Page_ParkIntro_Traffic[0].Base,data.jsonOutput.Page_ParkIntro_Traffic[0],data.jsonOutput.Page_ParkIntro_Traffic[0].helpTel));
		            		}else{
				            	for(var i=0;i<data.jsonOutput.Page_ParkIntro_Index.length;i++){
									if(data.jsonOutput.Page_ParkIntro_Index[i].Base==selectValue){
				            			//index
				            			$("#subDiv_introInfo").html(data.jsonOutput.Page_ParkIntro_Index[i].HTML);
							            break;
						            }
					            }
				            	for(var i=0;i<data.jsonOutput.Page_ParkIntro_ContactInfo.length;i++){
									if(data.jsonOutput.Page_ParkIntro_ContactInfo[i].Base==selectValue){
							            //ContactInfo
							            $("#subDiv_contactInfo").html(data.jsonOutput.Page_ParkIntro_ContactInfo[i].HTML);
							            break;
						            }
					            }
				            	for(var i=0;i<data.jsonOutput.Page_ParkIntro_Traffic.length;i++){
									if(data.jsonOutput.Page_ParkIntro_Traffic[i].Base==selectValue){
							            //Traffic
							            $("#subDiv_traffic").html(genTrafficHTML(Park,data.jsonOutput.Page_ParkIntro_Traffic[i].Base,data.jsonOutput.Page_ParkIntro_Traffic[i],data.jsonOutput.Page_ParkIntro_Traffic[i].helpTel));
							            break;
						            }
					            }

					        }
				            //ArtInfo
				            $("#subDiv_artInfo").html(data.jsonOutput.Page_ParkIntro_ArtInfo.HTML);
				            //VisitInfo
				            $("#subDiv_visitInfo").html('<div style="text-align: left;" id="title">'+data.jsonOutput.Page_ParkIntro_VisitInfo.title+'</div><div style="text-align: left;" id="htmlResult">'+data.jsonOutput.Page_ParkIntro_VisitInfo.HTML+'</div>');	
				            //InvestmentInfo
				            // $("#InvestmentInfo").find('#title').html(data.jsonOutput.Page_ParkIntro_InvestmentInfo.title).trigger('create');
				            $("#subDiv_investmentInfo").html('<div style="text-align: left;" id="title">'+data.jsonOutput.Page_ParkIntro_InvestmentInfo.title+'</div><div style="text-align: left;" id="htmlResult">'+data.jsonOutput.Page_ParkIntro_InvestmentInfo.HTML+'</div>');
            	          	//隱藏所有subDiv
				          	$("#index .sub").hide();
				          	$("#index").find("#"+sub).show();
				          	$("a.sub_link[data-href="+sub+"]").addClass('hover');	
				            $("#index").trigger('create');
			            }
			        },
			        error: function(data){
			            LoadingObject.hide();
			            smoke.alert(ServiceErrorString,{},function(){});
			        },
			        complete: function() {
			            LoadingObject.hide();
			        }
			    });
				
			}
			/*pageini event*/
			$(document).on('pageinit','#index',function(){
				//產生跑馬燈
				var jsonObject=getAppInstantMessage();
				if(jsonObject!=null){
					var title=jsonObject.title;
					genAppInstantMessage($('#newsDiv'),title);
				}
				//產生menu
				genMenu(this);
				//menu登入確認
				menuDisplayMemberSection(checkLogin(),this);
				// //手勢動作
				// $(this).on('swiperight',function(){
				// 	$( "#menu" ).panel( "toggle" );
				// });
				//取得上方顯示
				loadDisplayLanguage();
				//產生上方topList
				$("#index sub-menu").html(genTopList());
				//讀取資料
				getAreaIntroData(Park,"00","subDiv_introInfo");	
				//subDiv
				$(this).on('click','.sub_link',function(){
		          	$("#index a.sub_link").removeClass('hover');
		          	$("#index .sub").hide();
		          	$("#"+$(this).data('href')).show();
		          	$(this).addClass('hover');
		          	//預設
		          	$('#index #footer').hide();
		          	$('#selectBase').css('display', 'none').parent('div').parent('.ui-select').css('display', 'none');
		          	var selectedValue=$('#selectBase').find(":selected").val();
		          	$('#selectBase').html('');
		          	var options=$('#selectBase_temp option');
		          	switch($(this).data('href'))
		          	{
		          		case "subDiv_introInfo":
			          		$('#selectBase').css('display', '').parent('div').parent('.ui-select').css('display', '');
			          		// $('#selectBase option:eq(0)').show();
		          			break;
		          		case "subDiv_traffic":
			          		$('#selectBase').css('display', '').parent('div').parent('.ui-select').css('display', '');
			          		$('#index #footer').show();
		          			break;
		          		case "subDiv_contactInfo":
							$('#selectBase').css('display', '').parent('div').parent('.ui-select').css('display', '');
		          			break;
		          		case "subDiv_artInfo":
			          		$('#selectBase').css('display', '').parent('div').parent('.ui-select').css('display', '');
		          			break;
		          	}
		          	for(var i=0;i<options.length;i++){
		          		if(i==0&&$(this).data('href')!="subDiv_introInfo"){

		          		}else{
			          		$('#selectBase').append($(options[i]).clone());
			          	}
		          	}
		          	$('#selectBase[value="'+selectedValue+'"]').attr('selectBase','selected');
		          	$('#selectBase').selectmenu('refresh', true);
				});
				//下拉園區
				$(this).on('change','#selectBase',function(){
					var selectValue=$(this).val();
					//讀取資料
					getAreaIntroData(Park,selectValue,$("#index a.sub_link.hover").data("href"));
				});
				//外開連結
				$(this).on('click','.btnOpenBrowser',function(){
					var url=$(this).data('linkurl');
					openBrowser(url);
				});
			});
			/*pageshow event*/
			$(document).on('pagebeforeshow','#VisitInfo_content',function(){
				var BackPageObject=getTranspotInfoBackPage();
				if(BackPageObject!=null){
					//讀取資料
					getAreaIntroData(BackPageObject.Park,BackPageObject.Base,"subDiv_traffic");
		          	$("#index .sub").hide();
		          	$("a.sub_link[data-href=subDiv_traffic]").addClass('hover');	
					//切回指定內容
					changeToTrafficContent(BackPageObject.Park,BackPageObject.Base,BackPageObject.code,true);
					//清除儲存
					clearTranspotInfoBackPage();
				}
			});
		/*地圖模組*/
		/*Map function*/
		function doClassify1Filter(Collapsible_Classify1_ID,classify1,isAll){
			var classifyArray=[];
			if(typeof(isAll)!="undefined"&&isAll){
				var checkedList=$('#classify1List input[type=checkbox]');
				//取得classifyArray
				for(var i=0;i<checkedList.length;i++){
					$(checkedList[i]).attr('checked',true).checkboxradio("refresh");
					classifyArray.push({ "classify1":$(checkedList[i]).data('classify1'),"classify2":$(checkedList[i]).data('classify2')});
				}
			}else{
				if(Collapsible_Classify1_ID!=""){
					// var checkedList=$('#'+Collapsible_Classify1_ID+' input[type=checkbox]:checked');
					var checkedList=$('#classify1List input[type=checkbox]:checked');
					//取得classifyArray
					for(var i=0;i<checkedList.length;i++){
						classifyArray.push({ "classify1":$(checkedList[i]).data('classify1'),"classify2":$(checkedList[i]).data('classify2')});
					}
				}
			}
			if(classifyArray.length==0){
				$('#popupDialog_classify1Filter').popup('close');
				if(langType!="eng"){
					smoke.alert(classify2RequirementString,{ok:"確認"},function(){
						$('#popupDialog_classify1Filter').popup('open');
					});
				}else{
					smoke.alert(classify2RequirementString_eng,{ok:"ok"},function(){
						$('#popupDialog_classify1Filter').popup('open');
					});
				}
			}else{
				switchFooterFunction('default');
				LoadingObject.show();
				var jsonObject={
				  "queryType": "3",
				  "langType": langType,
				  "park": getIdentifyParkBase().Park,
				  "inner": getIsInArea(),
				  "currentLat": getGPRSData.lat,
				  "currentLng":getGPRSData.lng,
				  "LBSSpotClassifyArray":classifyArray
				};
				//如果有LBSCenterLatLng的值(lat,lng)，則改為目的點為querylat,querylng
				if(typeof(map.LBSCenterLatLng)!=="undefined"&&map.LBSCenterLatLng!=null){
					 jsonObject={
					  "queryType": "1",
					  "langType": langType,
					  "park": getIdentifyParkBase().Park,
					  "currentLat": getGPRSData.lat,
					  "currentLng":getGPRSData.lng,
					  "queryLat": map.LBSCenterLatLng.lat,
					  "queryLng": map.LBSCenterLatLng.lng,
	  				  "LBSSpotClassifyArray":classifyArray
					}
				}
				var jsonObjectStr = JSON.stringify(jsonObject);
			    $.ajax({
			        url:DataURL_LBSQueryService,
			        data:  {"jsonInput":jsonObjectStr},
			        type:"POST",
			        dataType :"json",
			        async:false,
			        success:function(data){
			            if(data==null){
			                 smoke.alert(ServiceCodeErrorString,{},function(){});
			            }else{
			            	LP_jsonObjectArray=[];
			                if(data.statusCode=="200"){
			                	if(data.spotList.length>0){
			                		for(var i=0;i<data.spotList.length;i++){
			                			LP_jsonObjectArray.push({"spotNo":data.spotList[i].spotNo,"chtName":data.spotList[i].name,"chtAddress":data.spotList[i].address,"xicon":Setting_classifyImgSrc+data.spotList[i].xicon,"ximage":Setting_imgSrc+data.spotList[i].mainImage,"latitude":data.spotList[i].latitude,"longitude":data.spotList[i].longitude,"classify1":data.spotList[i].classify1,"classify2":data.spotList[i].classify2,"classify2_name":data.spotList[i].classify2Name});
			                			// LP_jsonObjectArray.push({"spotNo":data.spotList[i].spotNo,"chtName":data.spotList[i].name,"chtAddress":data.spotList[i].address,"xicon":getXiconImg(data.spotList[i].classify2),"ximage":Setting_imgSrc+data.spotList[i].mainImage,"latitude":data.spotList[i].latitude,"longitude":data.spotList[i].longitude,"classify1":data.spotList[i].classify1,"classify2":data.spotList[i].classify2,"classify2_name":data.spotList[i].classify2Name});
		
				                	}
			            		}
	            				convertToGMAPMarkers();
	        					$('#popupDialog_classify1Filter').popup('close');
			                }else{
			                    smoke.alert(ServiceCodeErrorString,{},function(){});
			                }
			            }
			        },         
			        error: function(data){
			            LoadingObject.hide(); 
			            smoke.alert(ServiceErrorString,{},function(){});
			        },
			        complete: function() {
			            LoadingObject.hide();
			        }
			    });
			}
		}
		function doClassifyClear(){
			var checkedList=$('#classify1List input[type=checkbox]:checked');
			for(var i=0;i<checkedList.length;i++){
				$(checkedList[i]).attr('checked',false).checkboxradio("refresh");
			}
		}
		function genClassify1List(){
			 LoadingObject.show();
			var jsonObject={"langType":langType};
			var jsonObjectStr = JSON.stringify(jsonObject);
			var str_search="查詢",str_close="關閉",str_clear="清除",str_all="全部";
			if(langType!="ch"){
				str_search="Search";
				str_close="Close";
				str_clear="Clear";
				str_all="ALL";
			}
			var nowCode1="";
			//var classify1ListResult='<a data-theme="c" data-code="" href="javascript:doClassify1Filter(&#39;&#39;);" data-role="button">全部</a>';
			var classify1ListResult='<div style="text-align:right"><a class="popupCloseBtn" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" style="position:absolute;top: -5px;left:-10px;">'+str_close+'</a></div><div data-role="collapsible-set" data-theme="c" data-content-theme="c" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d"><div data-role="controlgroup" id="topFunc" data-type="horizontal"><a data-theme="c" data-code="" href="javascript:doClassify1Filter(&#39;&#39;,&#39;&#39;,true);" data-role="button">'+str_all+'</a><a data-theme="c" data-code="" href="javascript:doClassifyClear();" data-role="button">'+str_clear+'</a></div>'
		    $.ajax({
		        url:DataURL_Classify,
		        data:  {"jsonInput":jsonObjectStr},
		        type:"POST",
		        dataType :"jsonp",
		        async:false,
		        success:function(data){
		            if(data==null){
		                 smoke.alert(ServiceCodeErrorString,{},function(){});
		            }else{
		                if(data.status=="success"){
							for(var i=0;i<data.jsonOutput.length;i++){
								if(nowCode1!=data.jsonOutput[i].code1){
									if(nowCode1!=""){
										classify1ListResult+='</ul><button data-theme="e" onclick="doClassify1Filter(&#39;Collapsible_Classify1_'+nowCode1+'&#39;,&#39;'+nowCode1+'&#39;);"'+'>'+str_search+'</button>';
										classify1ListResult+='</div>';
									}
									classify1ListResult+='<div data-role="collapsible" id="Collapsible_Classify1_'+data.jsonOutput[i].code1+'" class="Collapsible_Classify1" data-inset="false">';
									classify1ListResult+='<h2>'+data.jsonOutput[i].name1+'</h2>';
									// classify1ListResult+='<ul data-role="listview">';
									nowCode1=data.jsonOutput[i].code1;
								}
								// classify1ListResult+='<li data-classify1="'+data.jsonOutput[i].code2+'" data-classify2="'+data.jsonOutput[i].code2+'">'+data.jsonOutput[i].name2+'</li>';
								classify1ListResult+='<input data-theme="f" data-classify1="'+data.jsonOutput[i].code1+'" data-classify2="'+data.jsonOutput[i].code2+'" type="checkbox" name="checkbox_classifyList" id="checkbox_classifyList_'+data.jsonOutput[i].code2+'"><label for="checkbox_classifyList_'+data.jsonOutput[i].code2+'">'+data.jsonOutput[i].name2+'</label>';
							}
							if(data.jsonOutput.length>0){
								classify1ListResult+='</ul><button data-theme="e" onclick="doClassify1Filter(&#39;Collapsible_Classify1_'+nowCode1+'&#39;,&#39;'+nowCode1+'&#39;);"'+'>'+str_search+'</button>';
								classify1ListResult+='</div>';
							}
							$('#Map_LP').find('#classify1List').html(classify1ListResult).trigger('create');
						}
						else{
		                    smoke.alert(ServiceCodeErrorString,{},function(){});
		                }
		            }
		        },
		        error: function(data){
		            LoadingObject.hide(); 
		            smoke.alert(ServiceErrorString,{},function(){});
		        },
		        complete: function() {
		            LoadingObject.hide();
		        }
		    });
		}
		function getClassifyArray(checkedList){
			var classifyArray=[];
			for(var i=0;i<checkedList.length;i++){
				classifyArray.push({ "classify1":checkedList[i].code1,"classify2":checkedList[i].code2});
			}
			return classifyArray;
		}
		function changeToMap_CP(sn){
		    LoadingObject.show();
		    var str_route="規劃路線",str_call="撥打電話",str_map="地圖";
		    if(langType=="eng"){
		    	str_route="Route";
		    	str_call="Call";
		    	str_map="Map";
		    }
			// var jsonObject={"command":"select xLBSSpot.spotNo,xLBSSpot.chtName,xLBSSpot.chtAddress,xLBSSpot.engName,xLBSSpot.engAddress,xLBSSpot.latitude,xLBSSpot.longitude,xLBSSpot.parkArea,xLBSSpot.parkLocation,(case xLBSSpotPic.ximage when '' then '' else ('"+Setting_imgSrc+"'+xLBSSpotPic .ximage)   end) as ximage,xLBSSpotClassify.xLBSClassify1,xLBSSpotClassify.xLBSClassify2,xLBSClassify2.chtName as xLBSClassify2_name, xLBSClassify2.engName as xLBSClassify2_ename,xLBSSpot.telTitle,xLBSSpot.telNumber,xLBSSpot.telEngTitle,xLBSSpot.urlTitle,xLBSSpot.urlAddress,xLBSSpot.urlEngTitle,xLBSSpot.chtDesc,xLBSSpot.engDesc from xLBSSpot inner join xLBSSpotClassify on xLBSSpot.spotNo=xLBSSpotClassify.spotNo inner join xLBSClassify2 on xLBSSpotClassify.xLBSClassify2=xLBSClassify2.code left join xLBSSpotPic on xLBSSpot.spotNo=xLBSSpotPic.spotNo where xLBSSpotPic.entranceCode is NULL and xLBSSpot.spotNo="+sn+" order by xLBSSpotClassify.xLBSClassify1,xLBSSpotClassify.xLBSClassify2,xLBSSpot.spotNo"};
			var jsonObject={
				"queryType": "2",
				"langType": langType,
				"park": getIdentifyParkBase().Park,
				"inner": getIsInArea(),
				"currentLat": getGPRSData.lat,
				"currentLng":getGPRSData.lng,
				"spotNo":sn
			}
			var jsonObjectStr = JSON.stringify(jsonObject);
			var htmlResult="",otherImagesArray=[];
			var str_addr="地址",str_desc="地點描述";
			if(langType=="eng"){
				str_addr="Address";
				str_desc="Description";
			}
		    $.ajax({
		        url:DataURL_LBSQueryService,
		        data:  {"jsonInput":jsonObjectStr},
		        type:"POST",
		        dataType :"json",
		        async:false,
		        success:function(data){
		            if(data==null){
		                 smoke.alert(ServiceCodeErrorString,{},function(){});
		            }else{
		                if(data.statusCode=="200"||data.statusCode=="201"){
		                	if(data.spotList.length>0){
								//生活服務內容
		                		htmlResult+="<div class='ServiceCt'><div class='title'>"+data.spotList[0].name+"</div><ul class='photo'>";
		                		if(data.spotList[0].mainImage!=""){
		                			htmlResult+="<li class='here' ><img src='"+Setting_imgSrc+data.spotList[0].mainImage+"'></li>";
		                		}
		                		if(data.spotList[0].otherImages!=""){
			                		otherImagesArray=data.spotList[0].otherImages.split(',');
			                	}
		                		//等ken處理
		                		for(var i=0;i<otherImagesArray.length;i++){

		                			htmlResult+="<li";
		                			htmlResult+="><img src='"+Setting_imgSrc+otherImagesArray+"'></li>";
		                		}
		                		htmlResult+="</ul><ul class='info'>";
		                		if(typeof(data.spotList[0].address)!="undefined"&&data.spotList[0].address!=""){
	            					htmlResult+="<li>"+str_addr+":"+(typeof(data.spotList[0].address)=="undefined"?"":data.spotList[0].address)+"</li>";
	            				}
	            				if(typeof(data.spotList[0].telNumber)!="undefined"&&data.spotList[0].telNumber!=""){
		        					htmlResult+="<li>"+(typeof(data.spotList[0].telTitle)=="undefined"?"電話：":data.spotList[0].telTitle+"：")+(typeof(data.spotList[0].telNumber)=="undefined"?"":data.spotList[0].telNumber)+"</li>";
		        				}
		        				if(typeof(data.spotList[0].urlAddress)!="undefined"&&data.spotList[0].urlAddress!=""){
		        					htmlResult+="<li>"+((typeof(data.spotList[0].urlTitle)=="undefined"||data.spotList[0].urlTitle=="")?"網址：":data.spotList[0].urlTitle+"：")+"<a href='javascript:openBrowser(&#39;"+data.spotList[0].urlAddress+"&#39;);' >"+((typeof(data.spotList[0].urlAddress)=="undefined"||data.spotList[0].urlAddress=="http://")?"":data.spotList[0].urlAddress)+"</a></li>";
		        				}
		        				if(typeof(data.spotList[0].description)!="undefined"&&data.spotList[0].description!=""){
		        					htmlResult+="<li>"+str_desc+":"+data.spotList[0].description+"</li>";
		        				}
		                		htmlResult+="</ul></div>";
								//功能列
								htmlResult+="<div class='springboard2'><ul><li>"+
											"<button data-role='none' id='btnMap' data-xicon='"+Setting_classifyImgSrc+data.spotList[0].xicon+"' data-ximage='"+Setting_imgSrc+data.spotList[0].mainImage+"' data-title='"+data.spotList[0].name+"' data-latitude='"+data.spotList[0].latitude+"' data-longitude='"+data.spotList[0].longitude+"' data-spotno='"+data.spotList[0].spotNo+"' data-address='"+data.spotList[0].address+"' class='map'>"+str_map+"</button>"+
											"<button data-role='none' id='btnRoute' data-xicon='"+Setting_classifyImgSrc+data.spotList[0].xicon+"' data-ximage='"+Setting_imgSrc+data.spotList[0].mainImage+"' data-title='"+data.spotList[0].name+"' data-latitude='"+data.spotList[0].latitude+"' data-longitude='"+data.spotList[0].longitude+"' data-spotno='"+data.spotList[0].spotNo+"' data-address='"+data.spotList[0].address+"'  class='route'>"+str_route+"</button>"+
											"<button data-role='none' id='btnTel' data-tel='"+data.spotList[0].telNumber+"'  class='tel'>"+str_call+"</button>"+
											"</li></ul></div>";
		   					}
	        				$('#Map_CP').find('#content').html(htmlResult); 
	        				$.mobile.changePage('#Map_CP');
		                }else{
		                    smoke.alert(ServiceCodeErrorString,{},function(){});
		                }
		            }
		        },
		        error: function(data){
		            LoadingObject.hide(); 
		            smoke.alert(ServiceErrorString,{},function(){});
		        },
		        complete: function() {
		            LoadingObject.hide();
		        }
		    });
		}
		function switchRouteShowType(type){
			if(type=='path'){
				$('#routeList').show();
				$('#map_canvas').hide();
				$('#Map_LP').find('#btnRoute_MAPShow').removeClass('listbtn03').addClass('listbtn01');
				$('#Map_LP').find('#btnRoute_PathShow').removeClass('listbtn04').addClass('listbtn02');
			}else{
				$('#routeList').hide();
				$('#map_canvas').show();
				$('#Map_LP').find('#btnRoute_MAPShow').removeClass('listbtn01').addClass('listbtn03');
				$('#Map_LP').find('#btnRoute_PathShow').removeClass('listbtn02').addClass('listbtn04');
				//重整地圖尺寸跟地圖調整中心	
				map.refresh();
			}
		}
		function switchLPShowType(type){
			$('#routeList').hide();
			var htmlResult="";
			var nowClassify2="";
			var str_route="規劃路線";
			if(langType=="eng"){
				str_route="Route";
			}
			if(type=='list'){
				for(var i=0;i<LP_jsonObjectArray.length;i++){
				if(nowClassify2==""||(nowClassify2!=""&&nowClassify2!=LP_jsonObjectArray[i].classify2)){
					nowClassify2=LP_jsonObjectArray[i].classify2;
					htmlResult+='<li data-role="list-divider"><span>'+LP_jsonObjectArray[i].classify2_name+'</span></li>';
				}
				htmlResult+="<li data-latitude='"+LP_jsonObjectArray[i].latitude+"' data-longitude='"+LP_jsonObjectArray[i].longitude+"' data-spotno='"+LP_jsonObjectArray[i].spotNo+"'>"+
				"<div class='image'><img src='"+LP_jsonObjectArray[i].ximage+"'></div>"+
				"<h2>"+LP_jsonObjectArray[i].chtName+"</h2>"+
				"<p>"+LP_jsonObjectArray[i].chtAddress+"</p>"+
			    "<div class='btnbox'><input type='submit' data-role='none' data-xicon='"+LP_jsonObjectArray[i].xicon+"' data-ximage='"+LP_jsonObjectArray[i].ximage+"' data-title='"+LP_jsonObjectArray[i].chtName+"' data-address='"+LP_jsonObjectArray[i].chtAddress+"'  data-latitude='"+LP_jsonObjectArray[i].latitude+"' data-longitude='"+LP_jsonObjectArray[i].longitude+"' data-spotno='"+LP_jsonObjectArray[i].spotNo+"' value='"+str_route+"' class='btnDoRoute_dataList btn06'></div>"+
				"</li>";
				}
				$('#Map_LP').find('#dataList').html("<ul data-role='none'>"+htmlResult+"</ul><div style='height:100px;width:100%'></div>");
				$('#Map_LP').find('#dataMap').hide();
				$('#Map_LP').find('#dataList').show();
				$('#Map_LP').find('#btnMAPShow').removeClass('listbtn03').addClass('listbtn01');
				$('#Map_LP').find('#btnListShow').removeClass('listbtn04').addClass('listbtn02');
			}else
			{
				$('#Map_LP').find('#dataList').hide();
				$('#Map_LP #dataMap .subDiv').hide();
				// $('#routeList').hide();
				$('#Map_LP').find('#dataMap').show();
				$('#Map_LP').find('#btnMAPShow').removeClass('listbtn01').addClass('listbtn03');
				$('#Map_LP').find('#btnListShow').removeClass('listbtn02').addClass('listbtn04');
				//重整地圖尺寸跟地圖調整中心	
				map.refresh();
			}
		    return htmlResult;
		}
		function genMapShowContent(){
			var LBSCenterLatLng=null;
 			if(typeof(map)!="undefined"&&typeof(map.LBSCenterLatLng)!=="undefined"&&map.LBSCenterLatLng!=null){
 				LBSCenterLatLng=map.LBSCenterLatLng;
 			}
			map=new HyMap();
 			map.ini(document.getElementById('map_canvas'),new google.maps.LatLng(getGPRSData().lat,getGPRSData().lng),14);
 			//設定目的地與地圖顯示中心
 			if(LBSCenterLatLng!=null){
 				map.setLBSCenterLatLng(LBSCenterLatLng,true);
 			}
 			map.setDivDirectionDetail($('#Map_LP #directions'));
		}
		function convertToGMAPMarkers(){
			//地圖初始化
			genMapShowContent();
			switchLPShowType("map"); 
			//呈現LBS中心點位置
			map.showLBSCenterMarker();
			var nearAlertSpotListHtmlResult="";
			var str_ok="確定";
			var str_cancel="取消";
			if(langType!="ch"){
				str_ok="OK";
				str_cancel="Cancel";
			}
			for(var i=0;i<LP_jsonObjectArray.length;i++){
				//gmap marker
				var title=LP_jsonObjectArray[i].chtName;
				var address=LP_jsonObjectArray[i].chtAddress;
				var latitude=LP_jsonObjectArray[i].latitude;
				var longitude=LP_jsonObjectArray[i].longitude;
				var spotNo=LP_jsonObjectArray[i].spotNo;
				var ximage=LP_jsonObjectArray[i].ximage;//待續
				var xicon=LP_jsonObjectArray[i].xicon;//待續
				map.addAdvMarker(title,address,latitude,longitude,spotNo,ximage,xicon);
				console.log(latitude+"	"+longitude);
				//nearAlertSpotList
			    nearAlertSpotListHtmlResult+='<input type="radio" id="radio_nearAlertSpot_'+i+'" name="radio_nearAlertSpotList" data-spotno="'+spotNo+'" data-latitude="'+latitude+'" data-longitude="'+longitude+'" data-title="'+title+'" data-address="'+address+'" data-theme="c">'+'<label for="radio_nearAlertSpot_'+i+'">'+title+'</label>';
			}
			if(nearAlertSpotListHtmlResult!=""){
				nearAlertSpotListHtmlResult+='<div data-role="controlgroup" data-type="horizontal"><a data-theme="c" data-role="button" data-rel="back">'+str_cancel+'</a><a data-theme="f" href="javascript:setNearAlertByList();" data-role="button">'+str_ok+'</a></div>';
			}
			$('#nearAlertSpotList').html(nearAlertSpotListHtmlResult).trigger('create');
		}
		function switchFooterFunction(type){
			if(type=='route'){
				$('.defaultFootFunction').hide();
				$('.RouteFootFunction').show();
				switchRouteShowType('map');
			}else{
				$('.defaultFootFunction').show();
				$('.RouteFootFunction').hide();
				switchLPShowType('map');
			}
		}
		function showMapSubDiv(subDiv){
			var isShow=$(subDiv).is(":visible");
			switchLPShowType('map');
			isShow==true?$(subDiv).hide():$(subDiv).show();
		}
		function setNearAlertByList(){
			var obj=$("#nearAlertSpotList input[type=radio]:checked");
			$('#popupDialog_setAlert').popup('close');
			if(typeof(obj)!="undefined"){
				doSetNearAlertSpot($(obj).data('spotNo'),$(obj).data('title'),$(obj).data('address'),$(obj).data('latitude'),$(obj).data('longitude'));
			}else{
				if(langType!="eng"){
					smoke.alert(nearAlertString_notCheckedBeforeSendFromList,{},function(){});
				}else{
					smoke.alert(nearAlertString_notCheckedBeforeSendFromList_eng,{},function(){});
				}
			}
		}
		function doSetNearAlertSpot(spotNo,title,address,latitude,longitude){
			var content="";
			if(map.nearAlertSpot!=null){
				if(latitude==map.nearAlertSpot.latitude$$longitude==map.nearAlertSpot.longitude){
					if(langType!="eng"){
						smoke.alert(nearAlertString_already,{},function(){});
					}else{
						smoke.alert(nearAlertString_already_eng,{},function(){});
					}
				}else{
					if(langType!="eng"){
						content+="已經有設定接近提醒:"+map.nearAlertSpot.title+"<br/>"+
							 	 "地址:"+(typeof(map.nearAlertSpot.address)!=='undefined'?map.nearAlertSpot.address+"("+map.nearAlertSpot.latitude+","+map.nearAlertSpot.longitude+")":map.nearAlertSpot.latitude+","+map.nearAlertSpot.longitude)+",是否替換設定?";
						smoke.confirm(content,function(e){
							if (e){
								//設定接近提醒點
								map.setNearAlertSpot({"spotNo":spotNo,"title":title,"address":address,"latitude":latitude,"longitude":longitude});
								smoke.alert(SettingOKString);
							}
						},{ok:"確定", cancel:"取消"});
					}else{
						content+="The notification has been set:"+map.nearAlertSpot.title+"<br/>"+
							 	 "ADD:"+(typeof(map.nearAlertSpot.address)!=='undefined'?map.nearAlertSpot.address+"("+map.nearAlertSpot.latitude+","+map.nearAlertSpot.longitude+")":map.nearAlertSpot.latitude+","+map.nearAlertSpot.longitude)+",Would you like to change the setting of notification?";
						smoke.confirm(content,function(e){
							if (e){
								//設定接近提醒點
								map.setNearAlertSpot({"spotNo":spotNo,"title":title,"address":address,"latitude":latitude,"longitude":longitude});
								smoke.alert(SettingOKString_eng);
							}
						},{ok:"OK", cancel:"Cancel"});
					}
				}
			}else{
				//設定接近提醒點
				map.setNearAlertSpot({"spotNo":spotNo,"title":title,"address":address,"latitude":latitude,"longitude":longitude});
				if(langType!="eng"){
					smoke.alert(SettingOKString);
				}else{
					smoke.alert(SettingOKString_eng);
				}
			}	
		}
		//pageinit
		$(document).on('pageinit','#Map_LP',function(){	
			//調整map高度
			var mheight=(window.innerHeight-80)*0.9;
			$('#map_canvas').css('height',mheight);
			//產生gmap
			genMapShowContent();
			//Filter
			genClassify1List();
			//各分類
			$(this).on('collapse',"div[data-role=collapsible]",function(){
				var divList=$('div[data-role=collapsible]');
				var itemCount=0;
				for(var i=0;i<divList.length;i++){
					if($(divList[i]).css("display")=="block"){
						itemCount++;
					}
				}
				if(itemCount==1){
					if($(this).css("display")=="none"){
						$("#topFunc").css("display","none");
					}else{
						$("#topFunc").css("display","block");
					}
				}else if(itemCount>1){
					//目前這段有重復的問題未來應該可以改善
					if($(this).css("display")=="block"){
						$("#topFunc").css("display","block");
					}else{
						$("#topFunc").css("display","none");
					}
				}
			});
			//各項目
			$(this).find('#dataList').on('click','li[data-role!="list-divider"]',function(evt){
				if ($(evt.target).is("li")) {
	 				var spotNo=$(this).data("spotno");
	 				changeToMap_CP(spotNo);
	 			}
 			});
 			//切換地圖顯示
			$(this).on('click','#btnMAPShow',function(){	
				convertToGMAPMarkers();
				$(this).removeClass('listbtn01').addClass('listbtn03');
				$('#Map_LP').find('#btnListShow').removeClass('listbtn02').addClass('listbtn04');
				//重設地圖中心
		      	map.map.setCenter(new google.maps.LatLng(getGPRSData().lat,getGPRSData().lng));
			});
 			//切換條列顯示
			$(this).on('click','#btnListShow',function(){	
				switchLPShowType("list");
				$(this).removeClass('listbtn04').addClass('listbtn02');
				$('#Map_LP').find('#btnMAPShow').removeClass('listbtn03').addClass('listbtn01');
			});
			//切換地圖導引
			$(this).on('click','#btnRoute_MAPShow',function(){	
				switchRouteShowType('map');
			});
			//切換條列導引
			$(this).on('click','#btnRoute_PathShow',function(){	
				switchRouteShowType('path');
			});
 			//查詢關鍵字查地圖
			$(this).on('click','#btnSearch',function(){
				showMapSubDiv($('#Map_LP #divKeyWordSearch'));
			});
			//路線規劃地圖
			$(this).on('click','#btnRoute',function(){
				//地址反查
				map.getAddressByLatLng(new google.maps.LatLng(getGPRSData().lat,getGPRSData().lng),$('#Map_LP').find('#txtRoutePointStart'));
				//切換FooterFunction
				showMapSubDiv($('#Map_LP #divRoutePath'));
			});
			$(this).on('click','#btnKeyWordSearch',function(){
				switchFooterFunction('default');
				map.doSearchByAddress($('#txtSearchKeyWord').val());
			});
			$(this).on('click','#btnDoRoute',function(){
				//關閉幕前顯示div
				$('#Map_LP #dataMap .subDiv').hide();
				switchFooterFunction('route');
				map.doRoutePath($('#txtRoutePointStart').val(), $('#txtRoutePointEnd').val());
			});
			$(this).on('click','#btnDoRoute_InfoWindow',function(){
				var rootElement=$(this);
				//關閉幕前顯示div
				$('#Map_LP #dataMap .subDiv').hide();
				switchFooterFunction('route');
				var title=$(this).data('title');
 				var latitude=$(this).data('latitude');
 				var longitude=$(this).data('longitude');
 				var spotNo=$(this).data('spotno');
 				var address=$(this).data('address');
 				var ximage=$(this).data('ximage');
 				var xicon=$(this).data('xicon');
 				var jsonObject={"title":title,"address":address,"latitude":latitude,"longitude":longitude,"spotNo":spotNo,"ximage":ximage,"xicon":xicon};
				map.doRoutePath(new google.maps.LatLng(getGPRSData().lat,getGPRSData().lng),new google.maps.LatLng($(rootElement).data('latitude'),$(rootElement).data('longitude')),null,jsonObject);
 				title=null;latitude=null;longitude=null;lbs=null;address=null;ximage=null;xicon=null;jsonObject=null;
 				delete title;delete latitude;delete longitude;delete lbs;delete address;delete ximage;delete xicon;delete jsonObject;
			});
			$(this).on('click','input.btnDoRoute_dataList',function(){
				var rootElement=$(this);
				switchLPShowType("map");
				$('#Map_LP').find('#btnMAPShow').removeClass('listbtn01').addClass('listbtn03');
				$('#Map_LP').find('#btnListShow').removeClass('listbtn02').addClass('listbtn04');
				//關閉幕前顯示div
				$('#Map_LP #dataMap .subDiv').hide();
				switchFooterFunction('route');
				var title=$(this).data('title');
 				var latitude=$(this).data('latitude');
 				var longitude=$(this).data('longitude');
 				var spotNo=$(this).data('spotno');
 				var address=$(this).data('address');
 				var ximage=$(this).data('ximage');
 				var xicon=$(this).data('xicon');
 				var jsonObject={"title":title,"address":address,"latitude":latitude,"longitude":longitude,"spotNo":spotNo,"ximage":ximage,"xicon":xicon};
				map.doRoutePath(new google.maps.LatLng(getGPRSData().lat,getGPRSData().lng),new google.maps.LatLng($(rootElement).data('latitude'),$(rootElement).data('longitude')),null,jsonObject);
 				title=null;latitude=null;longitude=null;lbs=null;address=null;ximage=null;xicon=null;jsonObject=null;
 				delete title;delete latitude;delete longitude;delete lbs;delete address;delete ximage;delete xicon;delete jsonObject;
			});
			$(this).on('click','#btnLBSCP',function(){
				var spotNo=$(this).data('spotno');
				if(spotNo!=""){
					changeToMap_CP(spotNo);
				}
			});
			$(this).on('click','#btnSetNearAlert',function(){
				var spotNo=$(this).data('spotNo');
				var title=$(this).data('title');
				var address=$(this).data('address');
				var latitude=$(this).data('latitude');
				var longitude=$(this).data('longitude');
				doSetNearAlertSpot(spotNo,title,address,latitude,longitude);
			});
		});
		$(document).on('pageinit','#Map_CP',function(){	
 			//地圖按鈕
 			$(this).on('click','#btnMap',function(){
 				var title=$(this).data('title');
 				var latitude=$(this).data('latitude');
 				var longitude=$(this).data('longitude');
 				var spotNo=$(this).data('spotno');
 				var address=$(this).data('address');
 				var ximage=$(this).data('ximage');
 				var xicon=$(this).data('xicon');
 				//呈現當前坐標內容
 				map.showTargetMarker(title,address,latitude,longitude,spotNo,ximage,xicon);
 				$.mobile.changePage('#Map_LP');
 				title=null;latitude=null;longitude=null;lbs=null;address=null;ximage=null;xicon=null;
 				delete title;delete latitude;delete longitude;delete lbs;delete address;delete ximage;delete xicon;
 			});
 			//導航按鈕
			$(this).on('click','#btnRoute',function(){
				var rootElement=$(this);
				switchLPShowType("map");
				$('#Map_LP').find('#btnMAPShow').removeClass('listbtn01').addClass('listbtn03');
				$('#Map_LP').find('#btnListShow').removeClass('listbtn02').addClass('listbtn04');
				//關閉幕前顯示div
				$('#Map_LP #dataMap .subDiv').hide();
				switchFooterFunction('route');
				map.doRoutePath(new google.maps.LatLng(getGPRSData().lat,getGPRSData().lng),new google.maps.LatLng($(rootElement).data('latitude'),$(rootElement).data('longitude')));			
				$.mobile.changePage('#Map_LP');
			});
 			//電話按扭
 			$(this).on('click','#btnTel',function(){
 				var tel=$(this).data('tel');
 				if(typeof(tel)!="undefined"&&tel!=""){
	 				window.location.href="tel:"+tel;
	 			}
	 			tel=null;
	 			delete tel;
 			});
		});
		//pageshow
		$(document).on('pageshow','#Map_LP',function(){
			switchFooterFunction('default');
			var mapData=getMapData();
			if(typeof(mapData)!=="undefined"&&mapData!=null){
				//關閉幕前顯示div
				$('#Map_LP #dataMap .subDiv').hide();
				switch(mapData.method){
					case "route":
						switchFooterFunction('route');
					break;
				}
				//HyMap載入mapData資料
				map.loadMapData();
			}
			//重整地圖尺寸跟地圖調整中心	
			map.refresh();
			//取消事件
			$("#Map_LP .Collapsible_Classify1").off( "expand", function(){});
			$("#Map_LP .Collapsible_Classify1").off( "collapse", function(){});
			//註冊事件
			$("#Map_LP .Collapsible_Classify1").on( "expand", function() {
				Target_Collapsible_Classify1_ID=$(this).attr('id');
				$('#Map_LP .Collapsible_Classify1').hide();
				$(this).show();
			});
			$("#Map_LP .Collapsible_Classify1").on( "collapse", function() {
				if($(this).attr('id')==Target_Collapsible_Classify1_ID){
					$('#Map_LP .Collapsible_Classify1').show();
					$('#classify1List input[type=checkbox]:checked').attr('checked','checked');
					$('#classify1List').trigger('create');
				}
			});
		});
			</script>
			<div data-role="header" data-position="fixed" data-fullscreen="false" data-theme="f">
		        <a href="#menu" data-role="none" class="btnMenu"></a>
                <h1 id="page_title">科學園區簡介</h1>
    			<div id="newsDiv"></div>
			  	<!--toplist Start-->
			  	<div id="sub-menu" style="overflow:auto;height: 51px;">
				</div>
            </div>
			<div data-role="content" style="padding:0" id="content"  >
		  	<!--toplist end-->

			<!--int Start-->
		    <div class="int">
		        <select name="select" id="selectBase"></select>
		    	<div style="display:none" id="selectBase_temp"></div>
		        <div class="sub" id="subDiv_introInfo" ></div>
		        <div class="sub" id="subDiv_traffic"></div>
		        <div class="sub" id="subDiv_visitInfo" ></div>
		        <div class="sub" id="subDiv_investmentInfo" ></div>
		        <div class="sub" id="subDiv_contactInfo" ></div>
		        <div class="sub" id="subDiv_artInfo" ></div>
		    </div>
			<!--int End-->
			</div>
			<div data-theme="f" data-role="footer" style="display:none"  id="footer" data-position="fixed" data-fullscreen="false">
			</div>
		</div>
		<!--如何到園區_內容頁-->
		<div class="gridContainer clearfix" data-role="page" id="VisitInfo_content">
			<div data-role="header" data-position="fixed" data-fullscreen="false" data-theme="f">
				<a href="#index" data-icon="arrow-l" id="btnBack">返回</a>
                <h1>如何到園區</h1>
            </div>
			<div data-role="content" style="padding:0" id="content">
				<div class="list2" id="htmlResult">
				</div>
			</div>
			<div data-theme="f" data-role="footer" id="footer" data-position="fixed" data-fullscreen="false">		
			</div>
		</div>
		<!--地圖模組-->
		<div data-role="page" id="Map_LP">
			<div data-role="header" data-position="fixed" data-fullscreen="false" data-theme="f">
				<a data-rel="back" class="btn_back" data-icon="arrow-l">返回</a>
		     	<!-- <a href="#index" data-icon="arrow-l">返回</a> -->
                <h1 class="page_title">生活服務</h1>
            </div>
			<div data-role="content" style="padding:0" id="content">
				<div id='dataMap' class='acenter'>
					<!-- keyWordSearch -->
					<div id='divKeyWordSearch' class='subDiv'>
						<input data-role='none' type='text' class='search' id='txtSearchKeyWord' placeholder='地址/地名/廠商名稱'>
						<a id='btnKeyWordSearch'   data-mini="true" data-inline="true" data-role="button" data-theme="e">查詢</a>
					</div>
					<!-- RountePath -->
					<div id='divRoutePath' class='subDiv aleft2'>
						<div data-role="fieldcotain">
							<label id="labRoutePointStart" for='txtRoutePointStart'>起點：</label>
							<input type='text'  id='txtRoutePointStart' placeholder='地址/地名/廠商名稱'>
						</div>
						<div data-role="fieldcotain">
							<label id="labRoutePointEnd" for='txtRoutePointEnd'>終點：</label>
							<input type='text' id='txtRoutePointEnd' placeholder='地址/地名/廠商名稱'>
						</div>
						<div class="acenter"><button data-icon="search"  data-mini="true" data-inline="true" data-theme="e" id='btnDoRoute'>路徑規劃</button></div>
					</div>
					<!-- map -->
					<div id='map_canvas' style='width:100%;height:290px;'></div>
					<div id="routeList" class="ui-listview ui-listview-inset ui-corner-all ui-shadow" style="display:none;">
						<div id="divDirectionHeader" class="ui-li ui-li-divider ui-btn ui-bar-b ui-corner-top ui-btn-up-undefined">規劃路徑</div>
						<div id="directions" class='acenter gmapDirections'></div>
						<div class="ui-li ui-li-divider ui-btn ui-bar-b ui-corner-bottom ui-btn-up-undefined"></div>
						<!-- 撐高用的 -->	
						<div style="height:80px;"></div>
					</div>
				</div>
				<div class='list' id='dataList'></div>
			</div>
			<div data-theme="f" data-role="footer" data-position="fixed" data-fullscreen="false">	
				<div id="footer">
					<div class="footbtn">
						<ul data-role="none">
							<li><a data-role="none" id="btnMAPShow" class="defaultFootFunction listbtn03">地圖呈現</a></li>
							<li><a data-role="none" id="btnListShow" class="defaultFootFunction listbtn04">圖文並列</a></li>
							<li><a data-role="none" style="display:none;" id="btnRoute_MAPShow" class="RouteFootFunction listbtn03">地圖導引</a></li>
							<li><a data-role="none" style="display:none;" id="btnRoute_PathShow" class="RouteFootFunction listbtn04">文字導引</a></li>
						</ul>
					</div>
					<div class="function">
						<ul data-role="none">
							<li><a data-role="none" id="btnSearch" class="f1">搜尋地圖</a></li>
							<li><a data-role="none" id="btnRoute" class="f2">規劃路線</a></li>
							<li><a data-role="none" data-rel="popup" data-position-to="window" href="#popupDialog_classify1Filter" data-transition="pop" id="btnClassify1Filter" class="f3">週邊生活服務</a></li>
							<li><a data-rel="popup" data-position-to="window" href="#popupDialog_setAlert" data-transition="pop" data-role="none" id="btnSetAlert" class="f4">接近提醒</a></li>
						</ul>
					</div>
				</div>
			</div>
			<!--popup-->
			<div data-role="popup" id="popupDialog_classify1Filter" data-overlay-theme="a" data-theme="a" data-dismissible="false" style="max-width:400px;" class="ui-corner-all">
    			<div style="text-align:center;padding:25px" id="classify1List" class="ui-content">	
		    	</div>
			</div>
			<div data-role="popup" id="popupDialog_setAlert" data-overlay-theme="a" data-theme="a" data-dismissible="false" style="max-width:400px;" class="ui-corner-all">
    			<div style="text-align:center;" id="nearAlertSpotList">	
		    	</div>
			</div>
		</div>
		<div data-role="page" id="Map_CP">
			<div data-role="header" data-position="fixed" data-fullscreen="false" data-theme="f">
				<a data-rel="back" class="btn_back" data-icon="arrow-l">返回</a>
                <h1 class="page_title">生活服務</h1>
            </div>
			<div data-role="content" style="padding:0" id="content">
			</div>
		</div>
	</body>
</html>