<!DOCTYPE html>
<html lang="zh"><!-- manifest="cache.appcache" 開啟Cache 功能-->
    <head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
        <!--ios-->
        <!--<script type="text/javascript" src="js/ios/cordova-2.5.0.js"></script>-->
        <!--android-->
         <script type="text/javascript" src="js/android/cordova-2.7.0.js"></script>
        <!--jQuery-->
        <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
		<!--json2-->
		<script type="text/javascript" src="js/js.min/json2.min.js"></script>
		<!--Google Map API v3-->
		<!--<script type="text/javascript"	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDE9qxWxKreYH34oRyk2RCtM5-VqrauTPc&sensor=false"></script>-->
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<!--mobiScroll-->
		<script src="js/mobiscroll.core.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/mobiscroll.select.js"></script>
		<link href="css/mobiscroll.custom-2.4.3.min.css" rel="stylesheet" type="text/css"></link>
		<script src="js/mobiscroll.custom.js" type="text/javascript"></script>
		<script>
		$(document).bind('mobileinit', function(){
			$.support.cors = true;
			$.mobile.allowCrossDomainPages = true; 
			//ajaxEnabled: false;
		});
		</script>
		<!--<script src="http://debug.phonegap.com/target/target-script-min.js#blackie1019"></script>-->
		<!--jQuery mobile-->
        <link rel="stylesheet" type="text/css" href="css/jquery.mobile-NSC-1.3.0.css"></link>
        <script type="text/javascript" src="js/jquery.mobile-1.3.0.min.js"></script>
        <!--Plug in-->
        <script src="js/jquery.hammer.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/smoke.min.css">
        <!-- <link rel="stylesheet" type="text/css" href="css/smoke.theme.100s.css"> -->
        <script src="js/smoke.js"></script>
		<!--Hyweb CSS-->
		<link rel="stylesheet" type="text/css" href="css/index.css"></link>
		<!--HYAPP-->
		<!--NSCAPP Javascript-->	
		<script src="js/setting.js"></script>
		<script src="js/loading.js"></script> 
		<script src="js/pnpolygon.js"></script>
		<script src="js/photo.bfs.js"></script>
		<script src="js/location.js"></script>	
		<script src="js/data.js"></script>	
		<script type="text/javascript">
		
		//取得頁面二次驗證token
		/*  */
		var dataObject=getLoginData();
		setToken2VaildBackPage("Page_BizFileSharing.html");
		if(dataObject==null||typeof(dataObject.token2)=="undefined"){
			window.location="Page_Login.html#MemberValidation";
		}else{
			doVaildToken2(dataObject.token2,"Page_BizFileSharing.html");
		}
		/*  */
		var photo=new Photo();		
			
		</script>
		<script type="text/javascript">
		/*
		 * Global variables
		*/
		var loginUser = "";
		var loginUserName = "";
		/*MoveTo setting.js
		var DataURL_BFS_android = "http://TAP0515.nsc.gov.tw/BFS/Main2.do";
        var DataURL_BFS_android_Upload = "http://TAP0515.nsc.gov.tw/BFS/Upload.do";
		var DataURL_BFS_GETORGLIST = "http://nscallinone2.hyweb.com.tw:8080/AppService/getOrgList.do?jsoncallback=?";
		var DataURL_BFS_GETORGINFO = "http://nscallinone2.hyweb.com.tw:8080/AppService/getOrgInfo.do?jsoncallback=?";
		*/
		//DataURL_BFS = "http://192.168.1.6:8081/AppService/Main.do";
        //DataURL_BFS_android_Upload = "http://192.168.1.6:8081/AppService/Upload.do";
		
		var ListType = 0;//0:已接收檔案列表(default)  1:已傳送檔案列表
		var peopleToSend = "";//leee.ntspb,wclee.ntspb
		var peopleNameToSend = "";//李日興,李婉倩		
		var orderByField = $('input[name="orderByFieldRadio"]').val()||'m2.deditTime';
		var orderByWay = $('input[name="orderByWayRadio"]').val()||'desc';
		var delBRID = "";
		var downloadFileNo = "";
		
		//forward
		var peopleToForward = "";//leee.ntspb,wclee.ntspb
		var peopleNameToForward = "";//李日興,李婉倩
		function zero(str) {
			return str<10?('0'+str):str;
		}
		function iniControlSetting(){
			window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError);
			//var today=new Date().toISOString().slice(0,10);
			//$("input[type=date]").val(today);
			/* */
			var today = new Date();
			var today_year=today.getFullYear();
			var today_month=today.getMonth();
			var today_date=today.getDate();	
			$("input[type=date]").val(today_year+"-"+zero(today_month+1)+"-"+zero(today_date));			
			/* */
		}
		
		
		// pageinit
		$(document).on('pageinit','#LP',function(){
			var member = getLoginData();
			loginUser=member.account||"leee.ntspb";
			loginUserName=member.accountName||"李日興";
			//loginUser="leee.ntspb";
			//loginUserName="李日興";
			//產生menu
			genMenu(this);
			//menu登入確認
			menuDisplayMemberSection(checkLogin(),this);
			//控制項初始化設定
			iniControlSetting();
 			//條列呈現
			loadData(orderByField,orderByWay,ListType);
			
			// 下方功能1: 新增檔案
			$('#newFileButton').click(function() {
				$.mobile.changePage('#newFilePage');
			});
			
			// 下方功能2: 查詢
			$('#queryButton').click(function() {			
				$('#popupDialog_advSearch').popup('close');
				//checkdate
				if ($('#dateBegin').val()!='' && $('#dateEnd').val()!=''
				&& $('#dateBegin').val()<=$('#dateEnd').val()) {
					loadData('','',ListType);	
				} else {
					smoke.alert("請輸入正確的日期區間",{},function(){});
				}				
			});
			
			// 下方功能3: 匯出清單
			/*  *
			$('#exportButton').click(function() {
				//location.href=DataURL_BFS+'?op=getTransferredFileListTXT&loginUser=leee.ntspb';
				var op = (ListType==0)?"getReceivedFileListTXT":"getTransferredFileListTXT";		
				var url = DataURL_BFS+'?op='+op+'&loginUser='+loginUser;
				openBrowser(url);
			});/*  */
			// 下方功能3: 重新整理
			$('#refreshFileButton').click(function() {
				window.location.reload();
			});
			
			// 上方功能1: 排序
			$('#orderButton').click(function() {			
				//loadData('m1.deditTime','asc',ListType);
				$('#orderBySenderFieldName').html(ListType==0?"寄件者":"收件者");
				$('#orderByDateFieldName').html(ListType==0?"接收日期":"傳送日期");
				$('#popupDialog_ordermenu').popup('open');				
			});
			
			$('#orderSearchButton').click(function() {
				orderByField = $('input[name="orderByFieldRadio"]:checked').val()||'m2.deditTime';
				orderByWay = $('input[name="orderByWayRadio"]:checked').val()||'desc';
				//alert(orderByField+" "+orderByWay + " " + ListType);
				loadData(orderByField,orderByWay,ListType);				
				$('#popupDialog_ordermenu').popup('close');
			});
			
			$('#downloadButton').click(function() {
				openBrowser($('#dl'+downloadFileNo).text());
				$('#popupDialog_listmenu').popup('close');			
			});
			
			//轉寄
			$('#forwardButton').click(function() {		
				//alert(downloadFileNo);
				window.localStorage.setItem("SettingData_forwardOrSend", 'forward');
				window.localStorage.setItem("SettingData_forwardFileNo", downloadFileNo);
				$.mobile.changePage('#chooseUserPage');
			});
			
			$('#deleteButton').click(function() {
				if (delBRID=="") {
					smoke.alert("尚未選擇欲刪除項目",{},function(){});
					return;
				}

				if (confirm("確定要刪除?")) {			
					var jsonObj = {'op':'removeFromTransferredList',
						'loginUser':loginUser,
						'loginUserName':encodeURI(loginUserName),
						'mailBRId':delBRID};
					var jsonObjStr = JSON.stringify(jsonObj);					
					$.ajax({
						cache: false,
						type: 'post',
						url: DataURL_BFS,
						data: "jsonInput="+jsonObjStr+"&name=DataURL_BFS&jsoncallback=?",
						dataType: 'json',
						success: function(response) {
							smoke.alert(response.message,{},function(){});													
							$.mobile.changePage('#LP');
							//$('#LP').trigger('pageinit');
						},
						error: function() {
							smoke.alert(ServiceErrorString,{},function(){});
						},
						complete: function() {
							LoadingObject.hide();
						}
					});
				}
			});	
			
			//--先不做
			/* *
			$('#fileList li').click(function() {
				var fileNo = $(this).attr('fileNo');
				alert(fileNo);
				//$('#popupDialog_listmenu').popup('open');
			});
			/* */			
 		});
		
		// New file page init
		$(document).on('pageinit','#newFilePage',function(){
		
            var rootElement=this;
            photo.initValue=false;
            photo.initialize("newFilePage",$(rootElement).find('#imageArray'));
                       
			$(this).on('click','#shootButton',function(){
				photo.capturePhoto("camera",function(){
                    $.mobile.changePage('#newFilePage');
				});			
				
			});
			$('#newFilePage').on('click','#libraryButton',function(){
				photo.capturePhoto("album",function(){
                    $.mobile.changePage('#newFilePage');
				});
            
			});
           
			// 選擇發送對象
			$(this).on('click','#chooseUserButton', function() {				
				// 選擇對象前先上傳
				var imageArray=getImageArray2($('#newFilePage').find('#imageArray img'));
				var jsonObj = {'loginUser':loginUser,'imageArray':imageArray};
				var jsonObjStr = JSON.stringify(jsonObj);
				/* */
				$.ajax({					
					//url:DataURL_BFS_Upload,
					url: DataURL_BFS,
					//data: "jsonInput="+jsonObjStr,
					data: {"name":"DataURL_BFS_Upload","jsonInput":jsonObjStr,"jsoncallback":"?"},
					//data: "jsonInput="+jsonObjStr+"&name=DataURL_BFS_Upload&jsoncallback=?",
					type:"POST",
					dataType :"json",
					async:false,
					success:function(data){
						LoadingObject.hide();
						// TO-DO after uploaded
						smoke.alert(JSON.stringify(data),{},function(){});
							
						if (data!=null && data.status=="success") {
							window.localStorage.setItem("SettingData_forwardOrSend", 'send');
							window.localStorage.setItem("SettingData_upload_result",JSON.stringify(data));
							//JSON.parse(window.localStorage.getItem("SettingData_upload_result"));
						} else {
							smoke.alert("上傳發生問題，請稍後再試",{},function(){
								$.mobile.changePage('#LP');
								$('#LP').trigger('pageinit');
							});
						}
					},
					error: function(data){
						LoadingObject.hide();
						smoke.alert(ServiceErrorString,{},function(){});
					},
					complete: function() {
						LoadingObject.hide();
						member=null;params=null;jsonObjectStr=null;
						delete member;delete params;delete jsonObjectStr;
					}
				});
				/* *
				var data = {
					"code": 200,
					"fileNo": "33",
					//"fileName": ["IMG_1.jpg","IMG_2.jpg","IMG_3.jpg"],
					"fileName": ["IMG_1.jpg"],
					"message": "upload successfully"
					};
				//暫存要寄的file
				window.localStorage.setItem("SettingData_upload_result", JSON.stringify(data));
				/*  */
				$.mobile.changePage('#chooseUserPage');
			});
			
		});
		
		$(document).on('pageinit','#confirmPage',function(){
			var forwardOrSend = window.localStorage.getItem("SettingData_forwardOrSend");			
			var peopleToSend = window.localStorage.getItem("SettingData_peopleToSend");
			var peopleNameToSend = window.localStorage.getItem("SettingData_peopleNameToSend");
			var fileNo = "";
			var fileName = "";
			
			if (forwardOrSend == "forward") {				
				fileNo = window.localStorage.getItem("SettingData_forwardFileNo");
			} else if (forwardOrSend == "sendFile") {						
				var uploadResult = JSON.parse(window.localStorage.getItem("SettingData_upload_result"));
				fileNo = uploadResult.fileNo;
				fileName = uploadResult.fileName;				
				//$('#fileToSend').html(uploadResult.fileNo);
				var fileNameList = "";
				fileNameList += fileName + "<br/>";
				//for (var i=0; i<uploadResult.fileName.length; i++) {
				//	fileNameList += uploadResult.fileName[i] + "<br/>";
				//}
				//$('#fileToSend').html(uploadResult.fileName);
				$('#fileToSend').html(fileNameList);
				
			} else {
				var uploadResult = JSON.parse(window.localStorage.getItem("SettingData_upload_result"));
				fileNo = uploadResult.fileNo;
				fileName = uploadResult.fileName;				
				//$('#fileToSend').html(uploadResult.fileNo);
				var fileNameList = "";
				for (var i=0; i<uploadResult.fileName.length; i++) {
					fileNameList += uploadResult.fileName[i] + "<br/>";
				}
				//$('#fileToSend').html(uploadResult.fileName);
				$('#fileToSend').html(fileNameList);
			}			
			
			//列出要寄的人員清單
			var htmlResult = "";
			htmlResult = "<ul data-role=\"listview\">";					
			var sendList = peopleNameToSend.split(",");
			for (var i=0; i<sendList.length; i++) {
				if (sendList[i]=='')
					continue;
				htmlResult += "<li><a href=\"#\">"+sendList[i]+"</a></li>";
			}
			htmlResult += "</ul>";
			$('#sendList').html(htmlResult);
			$('#sendList').trigger('create');
			
			//取消
			$('#cancelButton').click(function() {
				$.mobile.changePage('#LP');
				//$('#LP').trigger('pageinit');
			});		
			
			//送出/轉寄
			$('#sendButton').click(function() {
				if (peopleToSend=="") {
					smoke.alert("尚未新增傳送對象",{},function(){});
					return;
				}
				var op = (forwardOrSend == 'forward')?'forwardFile':'sendFile';
				
				// ajax preparation
				var jsonObj = {'op':op,
				'loginUser':loginUser,
				'loginUserName':encodeURI(loginUserName), 
				'fileNo':fileNo,
				'receiver':peopleToSend,
				'receiverName':encodeURI(peopleNameToSend),
				'mailBody':encodeURI($('#mailBody').val())};
				var jsonObjStr = JSON.stringify(jsonObj);
			
				$.ajax({					
					type: 'post',
					url: DataURL_BFS,
					data: "jsonInput="+jsonObjStr+"&name=DataURL_BFS&jsoncallback=?",
					dataType: 'json',
					async: false,
					success: function(response){					
						smoke.alert(response.message,{},function(){
									window.location='Page_BizFileSharing.html';
									});
						//smoke.alert(jsonObjStr,{},function(){});
						//$.mobile.changePage('#LP');
						//$('#LP').trigger('pageinit');
						
					},
					error: function() {
						smoke.alert(ServiceErrorString,{},function(){});
					},
					complete: function() {
						LoadingObject.hide();
					}
				});
			});
			
		});
		function loadOrgInfo(_unit_parts) {		
			LoadingObject.show();
			//拿nscuCode去找人員
			getUserList(_unit_parts[0], _unit_parts[1], function(data) {				
				LoadingObject.hide();
				var htmlResult = "";									
				if(data==null){
					 smoke.alert(ServiceCodeErrorString,{},function(){});
				}else{
					if(data.status=="success"){							
						htmlResult += "<fieldset data-role=\"controlgroup\">";
						
						var userList = data.jsonOutput.userList;
						for(var i=0;i<userList.length;i++){							
							var userId=userList[i].userId;
							var userName=userList[i].userName;													
							htmlResult += "<input value=\""+userId+"\" userName=\""+userName+"\" type=\"checkbox\" name=\"checkbox-1a\" id=\"checkbox-"+i+"a\" class=\"custom\" />";
							htmlResult += "<label for=\"checkbox-"+i+"a\">"+userName+"("+userId+")</label>";
							//$('#peopleList').append(htmlResult);
							//$('#checkbox-'+i+'a').attr('checked',true).checkboxradio('refresh');
							//htmlResult+="<option value=\""+nscuCode+"\">"+space+nscuDesc+"("+nscuCode+")(level "+level+")</option>";
							//htmlResult+="<li>";													
							//htmlResult+="<p>"+userName+"</p>";
							//htmlResult+="<div class=\"checkbox1\">";
							//htmlResult+="<input type=\"checkbox\" name=\"checkbox\" value=\""+userId+"\" userName=\""+userName+"\"/>";
							//htmlResult+="</div>";
							//htmlResult+="</li>";
							//htmlResult += "<a href=\"#\" data-role=\"button\" data-theme=\"e\">"+userName+"("+userId+")</a>";
						}						
						htmlResult += "</fieldset>";						
						
						if(htmlResult!=""){						
							$('#peopleList').html(htmlResult);
							//$("#peopleList input[type='checkbox']").checkboxradio("refresh");
							$('#peopleList').trigger("create");
							$('#chkAll').show();
							$('#cancelAll').show();
							//$("#peopleList input[name='checkbox-1a']").checkboxradio("refresh");
							//$('#chkAllBlock').show();
							/*  */
							$('#peopleList input[type=checkbox]').click(function() {				
								if ($(this).attr('checked')) {
									peopleToSend += $(this).val() + ",";
									peopleNameToSend += $(this).attr("userName") + ",";					
								}
								else {
									peopleToSend = peopleToSend.replace($(this).val() + ",", "");
									peopleNameToSend = peopleNameToSend.replace($(this).attr("userName") + ",", "");
								}
								//alert(peopleToSend+"\n"+peopleNameToSend);				
							});/*  */
							
							//全選
							$('#chkAll').click(function() {
								//reset
								peopleToSend = "";
								peopleNameToSend = "";				
								$("#peopleList input[type='checkbox']").each(function() {									 
									 //$(this).checkboxradio('enable');
									 $(this).attr('checked',true).checkboxradio("refresh");									 
									 peopleToSend += $(this).val() + ",";
									 peopleNameToSend += $(this).attr("userName") + ",";
								 });
							});
							//取消全選
							$('#cancelAll').click(function() {
								//reset
								peopleToSend = "";
								peopleNameToSend = "";				
								$("#peopleList input[type='checkbox']").each(function() {
									 $(this).attr('checked',false).checkboxradio("refresh");									 
								 });
							});
						}
						
					}else{
						smoke.alert(ServiceCodeErrorString,{},function(){});
					}
				}
			});
			
		}
		
		function loadOrgLevel5(_unit_parts) {		
			/*  */
			LoadingObject.show();
			var htmlResult = "";
			$('#dept5 option').remove();//先清空再load
			var jsonObj = {"AppType":_unit_parts[0],"level":"3"};
			var jsonObjStr = JSON.stringify(jsonObj);
			
			$.ajax({
				url:DataURL_BFS_GETORGLIST,
				data: {"jsonInput":jsonObjStr},				
				type:"POST",
				dataType :"jsonp",
				async:false,
				success:function(data){
					LoadingObject.hide();
					
					if(data==null){
						 smoke.alert(ServiceCodeErrorString,{},function(){});
					}else{				
						if(data.status=="success"){							
							
							for(var i=0;i<data.jsonOutput.unit.length;i++){							
								var level=data.jsonOutput.unit[i].level;	// 樹狀階層								
								var nscuCode=data.jsonOutput.unit[i].nscuCode;	// ORG代碼
								var nscuId=data.jsonOutput.unit[i].nscuId;	// ORG代碼
								var parentNscuId = getParentNscuId(data.jsonOutput.unit[i]);								
								var nscuDesc=data.jsonOutput.unit[i].nscuDesc; 	// 單位顯示名稱
								
								if (level == "5" && parentNscuId == _unit_parts[2]) {
									var value = _unit_parts[0]+","+nscuCode+","+nscuId;
									htmlResult+="<option value=\""+value+"\">"+nscuDesc+"</option>";
								}					
							}
							
							if(htmlResult!=""){
								$('#dept5').html(htmlResult);
							}
							
							//bind event
							$('#dept5').change(function() {
								var unit_part = $(this).val();// govCode,nscuCode,nscuId								
								if (unit_part != '') {
									loadOrgInfo(unit_part.split(","));
								}
							});
							
						}else{
							smoke.alert(ServiceCodeErrorString,{},function(){});
						}
					}
					
				},
				error: function(data){
					LoadingObject.hide();					
					smoke.alert(ServiceErrorString,{},function(){});
				},
				complete: function() {
					LoadingObject.hide();
					jsonObjStr=null;
					delete jsonObjStr;
				}
			}); /*  */
		}
		function loadOrgLevel4(_unit_parts) {		
			/*  */
			LoadingObject.show();
			var htmlResult = "";
			$('#dept4 option').remove();//先清空再load
			var jsonObj = {"AppType":_unit_parts[0],"nscuCode":_unit_parts[1],"level":"3"};
			var jsonObjStr = JSON.stringify(jsonObj);
			
			$.ajax({
				url:DataURL_BFS_GETORGLIST,
				data: {"jsonInput":jsonObjStr},				
				type:"POST",
				dataType :"jsonp",
				async:false,
				success:function(data){
					LoadingObject.hide();
					//alert(JSON.stringify(data));
					if(data==null){
						 smoke.alert(ServiceCodeErrorString,{},function(){});
					}else{				
						if(data.status=="success"){							
							for(var i=0;i<data.jsonOutput.unit.length;i++){							
								var level=data.jsonOutput.unit[i].level;	// 樹狀階層								
								var nscuCode=data.jsonOutput.unit[i].nscuCode;	// ORG代碼
								var nscuId=data.jsonOutput.unit[i].nscuId;	// ORG代碼
								var parentNscuId = getParentNscuId(data.jsonOutput.unit[i]);								
								var nscuDesc=data.jsonOutput.unit[i].nscuDesc; 	// 單位顯示名稱
								
								if (_unit_parts[0] == "M") {//國科會
									if (level == "3" && parentNscuId == _unit_parts[2]) {
										var value = _unit_parts[0]+","+nscuCode+","+nscuId;
										htmlResult+="<option value=\""+value+"\">"+nscuDesc+"</option>";
									}
								} else {								
									if (level == "4" && parentNscuId == _unit_parts[2]) {
										var value = _unit_parts[0]+","+nscuCode+","+nscuId;
										htmlResult+="<option value=\""+value+"\">"+nscuDesc+"</option>";
									}
								}
							}
							
							if(htmlResult!=""){
								$('#dept4').html(htmlResult);
							}
							
							//bind event
							$('#dept4').change(function() {
								var unit_part = $(this).val();// govCode,nscuCode,nscuId
								if (unit_part != '') {
									loadOrgInfo(unit_part.split(","));
									loadOrgLevel5(unit_part.split(","));									
								}
							});
							
						}else{
							smoke.alert(ServiceCodeErrorString,{},function(){});
						}
					}
					
				},
				error: function(data){
					LoadingObject.hide();					
					smoke.alert(ServiceErrorString,{},function(){});
				},
				complete: function() {
					LoadingObject.hide();
					jsonObjStr=null;
					delete jsonObjStr;
				}
			}); /*  */
		}
		
		//找單位parent nscuID
		function getParentNscuId(unit) {
			var units = unit.parentPath.split(",");
			return (units.length>1)?units[units.length-1]:units;
			
		}		
		// choose user page
		$(document).on('pageinit','#chooseUserPage',function(){
			$('#chkAll').hide();
			$('#cancelAll').hide();
			
			//第一層變動事件，載入第二層
			$('#dept3').change(function() {
				var unit_part = $(this).val();// govCode,nscuCode,nscuId
				if (unit_part != '')
					loadOrgLevel4(unit_part.split(","));
			});
							
			//確認人員
			$('#confirmButton').click(function() {
				if (peopleToSend == '' || peopleNameToSend == '') {
					smoke.alert("尚未新增傳送對象",{},function(){});
					return;
				}
				//alert(peopleToSend);
				//alert(peopleNameToSend);
				//暫存要寄的對象
				window.localStorage.setItem("SettingData_peopleToSend", peopleToSend);				
				window.localStorage.setItem("SettingData_peopleNameToSend", peopleNameToSend);
				
				$.mobile.changePage('#confirmPage');
				//$('#confirmPage').trigger('pageinit');				
				//$.mobile.changePage('#confirmPage', {changeHash:true, reloadPage:true, dataUrl:'#confirmPage'});
			});
			//查詢人員
			$('#searchButton').click(function() {
				smoke.alert("尚未實作",{},function(){});
			});
			
		});
        
		function getImageArray2(HTML_imgs){
			var imageArray=[],toRemove ="data:image/jpeg;base64,",imgSrc,isMain,imgObject;
			if(typeof(HTML_imgs) !== "undefined"&&HTML_imgs!=null&&HTML_imgs.length>0){
				for (var imgIndex=0;imgIndex< HTML_imgs.length; imgIndex++) {
					isMain=$(HTML_imgs[imgIndex]).data("ismain");
					imgSrc=$(HTML_imgs[imgIndex]).attr("src");
					if(typeof(imgSrc) !== "undefined"){
						imgSrc=imgSrc.replace(toRemove,'');
					}
					imgObject={'ximage':imgSrc};
					imageArray.push(imgObject);
				};
			}
			toRemove=null;imgSrc=null;imgObject=null;
			delete toRemove;delete imgSrc,delete imgObject;
			return imageArray;
		}
		
		//載入檔案清單列表
		function loadData(sortField, order, _ListType) {
			LoadingObject.show();
			ListType = _ListType;//set global parameter
			var op = (_ListType==0)?"getReceivedMailBodyList":"getTransferredMailBodyList";
			var htmlResult="";			
			
			var jsonObj = {'op':op,
				'loginUser':loginUser,
				'keyword':$('#keyword').val(),
				'dateBegin':$('#dateBegin').val(),
				'dateEnd':$('#dateEnd').val(),
				'sortField':sortField,
				'order':order};
			var jsonObjStr = JSON.stringify(jsonObj);
			//http://localhost:8081/AppService/Main.do?name=DataURL_BFS&jsonInput=&jsoncallback=?
			$.ajax({				
				type: 'post',
				url: DataURL_BFS,
				data: "jsonInput="+jsonObjStr+"&name=DataURL_BFS&jsoncallback=?",
				dataType :"json",
		        //async:false,
				success: function(response) {				
					if (response.status == "success") {
					
						//$('#fileList li').remove();
						$('#groupList div').remove();
						var dataList = response.jsonOutput.dataList;
						// 載入清單
						for (var i=0; i<dataList.length; i++) {
							var mailTitle = dataList[i].mailTitle;
							var mailBody = dataList[i].mailBody;
							var isvalid = dataList[i].isvalid;
							var mailBRId = dataList[i].mailBRId;
							var mailId = dataList[i].mailId;				
							var sender = dataList[i].sender;
							var senderName = dataList[i].senderName;
							var receiver = dataList[i].receiver;
							var receiverName = dataList[i].receiverName;
							var transferTime = dataList[i].transferTime;
							
							var file = dataList[i].file;
							var files = "";							
							var fileNos = "";
							for (var j=0; j<file.length; j++) {
							/*
								files += "<li style=\"display:none\" BRID1=\""+mailBRId+"\" fileNo=\""+file[j].fileNo+"\">";
								files += "<div class=\"image\"><a href=\"#\"><img src=\"img/NSC/file_"+file[j].fileExt+".png\" alt=\""+file[j].fileExt+"\"></a></div>";
								files += "<h2>"+file[j].nfileName+"</h2>";
								files += "<p class=\"filetime\"><font color=#06C>"+file[j].fileSize+"</font></p>"//1秒鐘前</p>;
								files += "<div class=\"arrow\"><a  onclick=\"openBrowser('"+file[j].downloadUrl+"\');><img src=\"img/NSC/arrow3.png\" alt=\"arrow\"></a></div>";
								files += "<div class=\"arrow\"><img src=\"img/NSC/arrow3.png\" alt=\"arrow\"></div>";
								files += "</li>";
								files += "<textarea id=\"dl"+file[j].fileNo+"\" style=\"display:none\">"+file[j].downloadUrl+"</textarea>";
								*/
								//files += "		<li data-theme=\"c\"><a onclick=\"openBrowser('"+file[j].downloadUrl+"\');>"
								//files += "		<li BRID=\""+mailBRId+"\" fileNo=\""+file[j].fileNo+"\" data-theme=\"c\"><a onclick=\"openBrowser('"+file[j].downloadUrl+"');\">";
								files += "		<li item=\"true\" BRID=\""+mailBRId+"\" fileNo=\""+file[j].fileNo+"\" data-theme=\"c\" style=\"font-size:14px;\">";
								files += "			<img src=\"img/NSC/file_"+file[j].fileExt+"@2x.png\" alt=\"pdf\">" + file[j].ofileName;
								files += "			<div style=\"font-weight:normal;font-size:12px;\" align=\"right\">"+file[j].fileSize+"</div>";
								//files += "			</h3>";
								files += "			<textarea id=\"dl"+file[j].fileNo+"\" style=\"display:none\">"+file[j].downloadUrl+"</textarea>";
								files += "		</li>";
								
								fileNos += file[j].fileNo + ",";
							}
							
							$('#groupList').append(
							"<div data-role=\"collapsible\" data-collapsed=\"true\" data-iconpos=\"right\" data-theme=\"c\">"
							//+"	<h3><font color=blue>" + mailBody + "("+mailId+")</font>"
							+"	<h3><font color=blue>" + mailBody + "</font>"
							+"		<p style=\"font-weight:normal;font-size:12px;\" align=\"right\">"+((_ListType==0)?senderName:receiverName)+" "+transferTime+"</p>"
							+"	</h3>"							
							+"	<ul data-role=\"listview\" data-split-icon=\"gear\">"
							+"		<li item=\"false\">"
							+"			<input BRID=\""+mailBRId+"\" mailId=\""+mailId+"\" fileNo=\""+fileNos+"\" name=\"forwardButton\" type=\"button\" value=\"轉寄\" data-inline=\"true\" data-mini=\"true\" data-icon=\"forward\"/>"
							+"			<input BRID=\""+mailBRId+"\" mailId=\""+mailId+"\" fileNo=\""+fileNos+"\" name=\"deleteButton\" type=\"button\" value=\"刪除\" data-inline=\"true\" data-mini=\"true\" data-icon=\"delete\"/>"
							+"		</li>"
							+files
							+"	</ul>"
							+"</div>"
							);							
						}

						/* */
						$('#groupList').trigger('create');
						$("#groupList li[item='true']").click(function() {						
							delBRID = $(this).attr('BRID');
							downloadFileNo = $(this).attr('fileNo');
							//$('li[BRID1='+delBRID+']').show();
							//alert(delBRID+","+downloadFileNo);
							$('#popupDialog_listmenu').popup('open');
						});
						/* */
						$("#groupList li[item='false'] input[name='forwardButton']").click(function() {						
							var groupId = $(this).attr('mailId');
							var fileNo = $(this).attr('fileNo');
							//alert(groupId+","+fileNo);
							
							//alert(downloadFileNo);
							window.localStorage.setItem("SettingData_forwardOrSend", 'forward');
							window.localStorage.setItem("SettingData_forwardFileNo", fileNo);
							$.mobile.changePage('#chooseUserPage');
							
						});
						
						$("#groupList li[item='false'] input[name='deleteButton']").click(function() {						
							var BRID = $(this).attr('BRID');
							var fileNo = $(this).attr('fileNo');
							//alert(BRID+","+fileNo);
							
							var jsonObj = {'op':'removeFromTransferredList',
									'loginUser':loginUser,
									'mailBRId':BRID};
							var jsonObjStr = JSON.stringify(jsonObj);
							$.ajax({
								type: 'post',
								url: DataURL_BFS,
								data: "jsonInput="+jsonObjStr+"&name=DataURL_BFS&jsoncallback=?",
								dataType :"json",
								//async:false,
								success: function(response) {
									smoke.alert(response.message,{},function(){window.location='Page_BizFileSharing.html';});																		
								},
								error: function() {
									smoke.alert(ServiceErrorString,{},function(){});
								},
								complete: function() {
									LoadingObject.hide();			
								}
							});
							
							
						});
						/* */
					}
				},
				error: function(xhr,msg,err) {					
					//alert('ajax request error');					
					smoke.alert(ServiceErrorString,{},function(){});
				},
				complete: function() {
					//$('#loading').fadeOut();					
					LoadingObject.hide();					
				}
			});
		}
		
		// SOA related functions
		function getOrgList(govCode,level) {//全部單位,展開層級			
			var htmlResult = "";
			var jsonObj = {"AppType":govCode, "level":level};
			var jsonObjStr = JSON.stringify(jsonObj);
			var orgList = [];
			$.ajax({
				url:DataURL_BFS_GETORGLIST,
				data: {"jsonInput":jsonObjStr},				
				type:"POST",
				dataType :"jsonp",
				async:false,
				success:function(data){				
					if(data==null){
						 smoke.alert(ServiceCodeErrorString,{},function(){});
					}else{
						if(data.status=="success"){							
							orgList = data.jsonOutput.unit;
							//alert(JSON.stringify(orgList));
						}else{
							smoke.alert(ServiceCodeErrorString,{},function(){});
						}
					}					
				},
				error: function(data){
					LoadingObject.hide();					
					smoke.alert(ServiceErrorString,{},function(){});
				},
				complete: function() {
					LoadingObject.hide();
					jsonObjStr=null;
					delete jsonObjStr;
				}
			}); /*  */
			
			return orgList;
		}
		function getUserList(govCode, nscuCode, onSuccess) {
			var htmlResult = "";
			var jsonObj = {"AppType":govCode,"nscuCode":nscuCode,"userStatus":"Y"};
			var jsonObjStr = JSON.stringify(jsonObj);
			
			$.ajax({
				url:DataURL_BFS_GETORGINFO,
				data: {"jsonInput":jsonObjStr},			
				type:"POST",
				dataType :"jsonp",
				async:false,
				success:onSuccess,
				error: function(data){
					LoadingObject.hide();					
					smoke.alert(ServiceErrorString,{},function(){});
				},
				complete: function() {
					LoadingObject.hide();
					jsonObjStr=null;
					delete jsonObjStr;
				}
			}); /*  */
		}

		</script>
		
<script type="text/javascript" charset="utf-8">
var fileSystem;

//generic getById
function getById(id) {
	return document.querySelector(id);
}
//generic content logger
function logit(s) {
	getById("#content").innerHTML += s;
}

//generic error handler
function onError(e) {
	//getById("#content").innerHTML = "<h2>Error</h2>"+e.toString();
	alert(e.toString());
}

function doDeleteFile(e) {
	fileSystem.root.getFile("test.txt", {create:true}, function(f) {
		f.remove(function() {
			logit("File removed<p/>"); 
		});
	}, onError);
}

function metadataFile(m) {
	logit("File was last modified "+m.modificationTime+"<p/>");	
}

function doMetadataFile(e) {
	fileSystem.root.getFile("test.txt", {create:true}, function(f) {
		f.getMetadata(metadataFile,onError);
	}, onError);
}

function readFile(f) {
	reader = new FileReader();
	reader.onloadend = function(e) {
		console.log("go to end");
		logit("<pre>" + e.target.result + "</pre><p/>");
	}
	reader.readAsText(f);
}

function doReadFile(e) {
	fileSystem.root.getFile("test.txt", {create:true}, readFile, onError);
}

function appendFile(f) {

	f.createWriter(function(writerOb) {
		writerOb.onwrite=function() {
			logit("Done writing to file.<p/>");
		}
		//go to the end of the file...
		writerOb.seek(writerOb.length);
		writerOb.write("Test at "+new Date().toString() + "\n");
	})

}

function doAppendFile(e) {
	fileSystem.root.getFile("test.txt", {create:true}, appendFile, onError);
}

function gotFiles(entries) {
	var s = "";
	for(var i=0,len=entries.length; i<len; i++) {
		//entry objects include: isFile, isDirectory, name, fullPath
		s+= entries[i].fullPath;
		if (entries[i].isFile) {
			s += " [F]";
		}
		else {
			s += " [D]";
		}
		s += "<br/>";
		
	}
	s+="<p/>";
	logit(s);
}

function doDirectoryListing(e) {
	//get a directory reader from our FS
	var dirReader = fileSystem.root.createReader();

	dirReader.readEntries(gotFiles,onError);		
}

/**
* 進到選取檔案頁面
*/
function doSelectFile(e) {

	$.mobile.changePage('#selectFilePage');//切換選擇檔案頁面
	$('#listFiles').empty();//先清空
	
	//讀取SD card的root層檔案
	var dirReader = fileSystem.root.createReader();
	dirReader.readEntries(function(entries) {
		var s = "<ul data-role=\"listview\">";
		for(var i=0,len=entries.length; i<len; i++) {
			if (entries[i].isFile)//顯示第一層檔案
			s+= "<li uri=\""+entries[i].fullPath+"\"><a href=#>"+(entries[i].isFile?"<img src=\"img/NSC/file.png\"/>":"<img src=\"img/NSC/list_icon01b.png\"/>")+" "+entries[i].name+"</a></li>";
		}
		s+="</ul>";
		
		$('#listFiles').append(s);
		$('#listFiles').trigger('create');
		$("#listFiles li").click(function() {
			//alert($(this).attr('uri'));
			var fileURI = $(this).attr('uri');
			var fileName = fileURI.substr(fileURI.lastIndexOf('/')+1);
			var ext = fileName.substr(fileName.lastIndexOf('.')+1, fileName.length);
			//alert(fileName+","+ext);
			//if (ext!='txt' && ext!='jpg' && ext!='doc'
			// && ext!='TXT' && ext!='JPG' && ext!='DOC') {
			//	smoke.alert("目前上傳支援格式：txt|jpg|doc",{},function(){});				
			//} else {
			
				//上傳前置設定
			
				var options = new FileUploadOptions();
				options.fileKey="file";
				options.fileName=fileURI.substr(fileURI.lastIndexOf('/')+1);
				//options.mimeType="text/plain";

				var params = new Object();
				params.value1 = "jsonInput";
				params.value2 = "{'loginUser':'"+loginUser+"','fileArray':[{'fname':'"+fileName+"','ext':'"+ext+"','file':'"+options.fileKey+"'}]}";

				options.params = params;

				var ft = new FileTransfer();
				ft.upload(fileURI, DataURL_BFS_android_Upload, win, fail, options);						
				/*  */
			//}
		});		
	}, onError);	
}

function onFSSuccess(fs) {
	fileSystem = fs;

	getById("#selectFileButton").addEventListener("touchstart",doSelectFile);
	
	//getById("#dirListingButton").addEventListener("touchstart",doDirectoryListing);			
	//getById("#addFileButton").addEventListener("touchstart",doAppendFile);			
	//getById("#readFileButton").addEventListener("touchstart",doReadFile);			
	//getById("#metadataFileButton").addEventListener("touchstart",doMetadataFile);			
	//getById("#deleteFileButton").addEventListener("touchstart",doDeleteFile);			
	//logit( "Got the file system: "+fileSystem.name +"<br/>" +
	//								"root entry name is "+fileSystem.root.name + "<p/>")	

	//doDirectoryListing();
}   
   
function onDeviceReady() {

	//request the persistent file system
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError);
	
	//uploadFile("file:///mnt/sdcard/test.txt");
	
}

function init() {
	document.addEventListener("deviceready", onDeviceReady, true);	
}  

function uploadFile(fileURI) {
	var options = new FileUploadOptions();
	options.fileKey="file";
	options.fileName=fileURI.substr(fileURI.lastIndexOf('/')+1);
	options.mimeType="text/plain";

    var params = new Object();
    params.value1 = "jsonInput";
    params.value2 = "{'loginUser':'leee.ntspb','fileArray':[{'fname':'xxx','ext':'txt','file':'12333'}]}";

    options.params = params;

    var ft = new FileTransfer();
    ft.upload(fileURI, "http://192.168.1.6:8080/BFS/Upload.do", win, fail, options);
}

function win(r) {
	//上傳成功
	smoke.alert("上傳成功",{},function(){				
		window.localStorage.setItem("SettingData_forwardOrSend", 'sendFile');
		window.localStorage.setItem("SettingData_upload_result",r.response);
		$.mobile.changePage('#chooseUserPage');
	});

	//alert(r.resposeCode);
	//alert(r.response);	
	/*
	if (r.response.code==200) {
		//上傳成功
		smoke.alert(r.response.message,{},function(){			
			window.localStorage.setItem("SettingData_forwardOrSend", 'sendFile');
			window.localStorage.setItem("SettingData_upload_result",JSON.stringify(r.response));
			$.mobile.changePage('#chooseUserPage');
		});		
	} else {
		smoke.alert("上傳發生問題，請稍後再試",{},function(){
			$.mobile.changePage('#LP');
			$('#LP').trigger('pageinit');
		});
	}
	/* */
    //console.log("Code = " + r.responseCode);
    //console.log("Response = " + r.response);
    //console.log("Sent = " + r.bytesSent);
}

function fail(error) {
    //alert("An error has occurred: Code = " = error.code);
	
	smoke.alert("上傳發生問題，請稍後再試",{},function(){
		$.mobile.changePage('#LP');
		$('#LP').trigger('pageinit');
	});
	
}

</script>  		
	</head>
	<body>	
		<div data-role="page" id="LP">		
			<div data-role="header" data-position="fixed" data-theme="b">
		     	<a href="#menu" data-role="none" class="btnMenu"></a>
                <h1>即時業務資訊</h1>
		     	<div data-role="controlgroup" data-type="horizontal" class="ui-btn-right" data-mini="true">
		     		<a href="#" id="orderButton"><img src="img/NSC/sequence01.png" alt="排序"></a>
<!-- 		     		<a data-transition="pop" data-rel="popup" data-position-to="window"  href="#popupDialog_advSearch"><img src="img/NSC/search.png" alt="查詢"></a> -->
		     	</div>
				<div data-role="navbar">
					<ul>
					  <li><a class="ui-btn-active" data-rel="popup" data-position-to="window" href="#" data-transition="pop" onclick="loadData('','',0);">已接收檔案</a></li>
					  <li><a data-rel="popup" data-position-to="window" href="#" data-transition="pop" onclick="loadData('','',1);">已傳送檔案</a></li>
					</ul>
				</div>
            </div>
			<div data-role="content" id="content" style="padding:0;margin:0">				
				<div id="groupList">
					<!--div data-role="collapsible" data-collapsed="true" data-iconpos="right" data-theme="b">
						<h3>即時業務資訊
							<div style="font-weight:normal;font-size:12px;" align="right">李日興 2013-05-28 04:40:00.123</div>
						</h3>					
						<ul data-role="listview">
							<li data-theme="c"><a href="">							
								<h3><img src="img/NSC/file_pdf.png" alt="pdf">南科簡訊第164期.pdf
								<div style="font-weight:normal;font-size:12px;" align="right">7.36MB</div>
								</h3>
							</a></li>
						</ul>
					</div-->
				</div>
				<!--toplist end-->
				<div class="list3" id="htmlResult">
					<ul id="fileList">
						<!--li>
							<div class="image"><a href="#"><img src="img/NSC/file_pdf.png" alt="pdf"></a></div>
							<h2>李婉倩</h2>
							<p>南科簡訊第164期.pdf</p>
							<p class="filetime">7.36 MB　1秒鐘前</p>
							<div class="arrow" data-role="collapsible" data-collapsed="true" data-theme="c" data-content-theme="c"
							><a href="#"><img src="img/NSC/arrow3.png" alt="arrow"></a></div>
						</li-->			
					</ul>
				</div>
				
			</div>
			
			<div data-theme="a" data-role="footer" data-position="fixed" data-tap-toggle="false">		
			  <div data-role="navbar">
			    <ul>
			      <li class="navli">
					<a data-rel="dialog" data-role="none" id="newFileButton"><span><img src="img/NSC/footer_icon13.png" alt="傳送檔案"></span><br/>傳送檔案</a>
				  </li>
			      <li>
					<a data-rel="popup" data-position-to="window" href="#popupDialog_advSearch" data-transition="pop">
					<span><img src="img/NSC/footer_icon01.png" alt="查詢"></span><br/>查詢</a>
				  </li>
			      <!--li>
					<a data-rel="popup" data-position-to="window" href="#" data-transition="pop" id="exportButton">
					<span><img src="img/NSC/footer_icon14.png" alt="匯出清單"></span><br/>匯出清單</a>
				  </li-->
  			      <li>
					<a data-rel="popup" data-position-to="window" id="refreshFileButton" data-transition="pop">
					<span><img src="img/NSC/footer_icon15.png" alt="重新整理"></span><br/>重新整理</a>
				  </li>
			    </ul>
			  </div>
			</div>	
			
			<!-- 下方功能#1: 查詢 -->
			<div data-role="popup" id="popupDialog_advSearch" data-overlay-theme="a" data-theme="a" data-dismissible="false" 
			style="" class="ui-corner-all">
				<input type="search" id="keyword" value="" placeholder="請輸入關鍵字">
				<span>起日：<input type="date" id="dateBegin"/></span>
				<span>迄日：<input type="date" id="dateEnd"/></span>
				<span><p align="right">				
				<a data-theme="c" href="javascript:history.back()" data-role="button" data-inline="true" data-mini="true">取消</a>
				<a data-theme="b" href="" data-role="button" id="queryButton" data-inline="true" data-mini="true">查詢</a>
				</p>
				</span>
			</div>

			<!-- 條列功能#1: 轉寄或刪除 -->
			<div data-role="popup" id="popupDialog_listmenu" data-overlay-theme="a" data-theme="a" data-dismissible="false" 
			style="max-width:500px;" class="ui-corner-all">	
				<div data-role="controlgroup">
					<a data-theme="b" href="" data-role="button" data-icon="arrow-d" id="downloadButton">下載</a>
					<a data-theme="d" href="" data-role="button" data-icon="forward" id="forwardButton">轉寄</a>
					<a data-theme="d" href="" data-role="button" data-icon="delete" id="deleteButton">刪除</a>			
					<a data-theme="d" href="javascript:history.back()" data-icon="home" data-role="button">取消</a>	
				</div>
			</div>
			
			<!-- 條列功能#2: 排序 -->
			<div data-role="popup" id="popupDialog_ordermenu" data-overlay-theme="a" data-theme="a" data-dismissible="false" 
			style="max-width:500px;" class="ui-corner-all">
				<fieldset data-role="controlgroup">
					<legend>請選擇排序欄位</legend>
					<input type="radio" name="orderByFieldRadio" id="orderBySender" value="m2.mailReceiver" checked="checked" />
					<label for="orderBySender"><span id="orderBySenderFieldName">依寄件者</span></label>

					<!--input type="radio" name="orderByFieldRadio" id="orderByFile" value="b.ofileName"  />
					<label for="orderByFile">依檔案名稱</label-->

					<input type="radio" name="orderByFieldRadio" id="orderByReceiveDate" value="m2.deditTime"  />
					<label for="orderByReceiveDate"><span id="orderByDateFieldName">依傳送日期</span></label>
				</fieldset>			
				<fieldset data-role="controlgroup" data-type="horizontal">
					<!--legend>請選擇排序方式：</legend-->
					<input type="radio" name="orderByWayRadio" id="radio-choice-21" value="desc" checked="checked" data-theme="a"/>
					<label for="radio-choice-21">遞減</label>

					<input type="radio" name="orderByWayRadio" id="radio-choice-22" value="asc"  data-theme="a"/>
					<label for="radio-choice-22">遞增</label>
				</fieldset>	
				<a data-theme="c" href="javascript:history.back()" data-role="button" data-inline="true">取消</a>
				<a data-theme="b" href="" data-role="button" id="orderSearchButton" data-inline="true" data-theme="b">確定</a>				
			</div>
				
		</div>
		
		<!-- 新增檔案頁面 -->
		<div data-role="page" id="newFilePage">
			<div data-role="header" data-position="fixed" data-theme="f"><button class="btnBack" data-icon="arrow-l">返回</button><h1>傳送檔案</h1></div>
			<div data-role="content">		

				<div class="int">
					<input type="button" id="selectFileButton" value="選擇檔案" data-icon="plus"></input>					
					<input type="button" id="shootButton" value="拍照" data-icon="plus"></input>
					<input type="button" id="libraryButton" value="從相片取得" data-icon="star"></input>
					<div id="imageArray"></div>
                    <img src="" id="showImg" style="max-width:120px;"/>
					<input type="button" id="chooseUserButton" value="選擇發送對象" data-icon="search" data-theme="a" data-inline="true"></input>
					<!--input type="button" id="uploadButton" value="上傳" data-icon="star"></input-->
				</div>
			</div>
		</div>
		
		<!-- 選擇人員頁面  -->
		<div data-role="page" id="chooseUserPage">
			<div data-role="header" data-position="fixed" data-theme="f"><button class="btnBack" data-icon="arrow-l">返回</button><h1>選擇對象</h1></div>
			<div data-role="content">
				<!--int Start-->
				<div class="int">
					<!--formbox star -->
					  <div class="formbox5">
					  <div class="aleft2">						  
						  <select name="dept3" id="dept3">
							<option value="">請選擇單位</option>
							<option value="M,nsc1,2">國科會</option>
							<option value="N,U0,73">科學工業園區管理局</option>
							<option value="C,61,94">中部科學工業園區管理局</option>
							<option value="S,60,20">南部科學工業園區管理局</option>
							</select>
							  <select name="dept4" id="dept4">
								<option value="">請選擇處/組室</option>						
							  </select>
								<select name="dept5" id="dept5">
								<option value="">請選擇科別</option>
							  </select>
							  <!--input name="peopleSearch" type="text" id="peopleSearch" placeholder="請輸入關鍵字" size="25">
							  <input type="button" name="reset" value="查詢" class="btn09" id="searchButton"/-->
							</div>							
				  </div>
					<!--formbox end -->					
					<a href="#" id="cancelAll" data-role="button" data-inline="true" data-mini="true">取消全選</a>
					<a href="#" id="chkAll" data-role="button" data-inline="true" data-mini="true" data-theme="b">全選</a>									
				  <div id="peopleList">
				  
				  </div>				
					<input type="button" name="reset" value="確認" class="btn09" id="confirmButton" data-theme="a" data-inline="true"/>
				</div>
				<!--int End-->
			</div>
		</div>
		
		<!-- 寄送確認頁面  -->
		<div data-role="page" id="confirmPage">
			<div data-role="header" data-position="fixed" data-theme="f"><button class="btnBack" data-icon="arrow-l">返回</button><h1>寄送確認</h1></div>
			<div data-role="content">
				<!--int Start-->				
				<div class="int">					
					<h3>已選擇傳送檔案：</h3>
					<div id="fileToSend"></div>
					<!--formbox end -->				
					<h3>請選擇傳送對象：<a href="javascript:history.back()"><img src="img/NSC/addfiles.png"/></a></h3>
					
					<!--20130519增加mailBody-->					
					<div data-role="fieldcontain">
						<textarea cols="40" rows="8" name="mailBody" id="mailBody" placeholder="請輸入檔案說明"></textarea>
					</div><br/>
					
					<!--list star -->
					<div id="sendList">						
					</div>
					<!--list end -->
					<br/>
					<input type="button" name="reset" value="取消" class="btn09" id="cancelButton" data-inline="true"/>
					<input type="button" name="reset" value="送出" class="btn09" id="sendButton" data-inline="true" data-theme="a"/>					
					
				</div>
				<!--int End-->
			</div>
		</div>
	
		<!-- 檔案選擇頁面  -->
		<div data-role="page" id="selectFilePage">
			<div data-role="header" data-position="fixed" data-theme="f"><button class="btnBack" data-icon="arrow-l">返回</button><h1>寄送確認</h1></div>
			<div data-role="content">
				<!--int Start-->				
				<div class="int">										
					<h3>請選擇檔案：</h3>
					
					<div id="content" data-role="content">
						<div class="content-primary" id="listFiles">
						</div>
					</div>					
				</div>
				<!--int End-->
			</div>
		</div>
	
	</body>
</html>